#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
\input colordvi
\usepackage{color}
\fancyhead{}
\fancyfoot[CE,CO]{}
\newtoks{\addressee} \global\addressee={}
\newdimen\longindent \longindent=3.5truein
\fancyhead[L]{Memo to: \the\addressee \\ \datetoday \\ Page \thepage \hfill}
\renewcommand{\headrulewidth}{0.0pt}
\newenvironment{lyxlist}[1]
{\begin{list}{}
{\settowidth{\labelwidth}{#1}
\setlength{\leftmargin}{\labelwidth}
\addtolength{\leftmargin}{\labelsep}
\renewcommand{\makelabel}[1]{##1\hfil}}}
{\end{list}}
\newcommand{\datetoday}{\number\day\space
     \ifcase\month\or January\or February\or March\or April\or May\or
     June\or July\or August\or September\or October\or November\or
     December\fi
     \space\number\year}
\newcommand{\EOLmemo}{\null \vskip-1.5truein
{\raggedright \textsf{\textsc{\large \textcolor{blue}{Earth Observing Laboratory}}}}\par
{\raggedright \textsf{\textsl{\textcolor{blue}{Memorandum:}}}} \par \vskip6pt
{\color{blue}{\hrule}}\par
\vskip0.3truein \leftline{\hskip \longindent \datetoday} \vskip0.2truein
\thispagestyle{empty}}
\newcommand{\attachm}[1]{\begin{lyxlist}{Attachments:00}
\item [Attachments:] {#1}
\end{lyxlist}}
\newcommand{\cc}[1]{\begin{lyxlist}{Attachments:00}
\item [cc:] {#1}
\end{lyxlist}}
\newcommand{\attach}[1]{\begin{lyxlist}{Attachments:00}
\item [Attachment:] {#1}
\end{lyxlist}}
%usage: \encl{A\\B\\C} or \cc{ma,e1\\name2\\name3}
\end_preamble
\use_default_options false
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding default
\fontencoding global
\font_roman "times" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize letterpaper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 0
\use_package mathdots 0
\use_package mathtools 1
\use_package mhchem 0
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.54cm
\topmargin 3.54cm
\rightmargin 2.54cm
\bottommargin 2.54cm
\headheight 1cm
\headsep 2cm
\footskip 0.5cm
\secnumdepth 2
\tocdepth 2
\paragraph_separation skip
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle fancy
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
global
\backslash
addressee={ARISTO-LAMS archive} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="2">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="0pt">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
To:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
the
\backslash
addressee
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
From:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Al Cooper
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Subject:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Studies of the measurements of wind using LAMS – C130 ARISTO2015/2016
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
bigskip
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<initialization,echo=FALSE,include=FALSE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

library(knitr)
\end_layout

\begin_layout Plain Layout

opts_chunk$set(echo=FALSE, include=FALSE, fig.lp="fig:", cache=FALSE)
\end_layout

\begin_layout Plain Layout

opts_chunk$set(fig.width=6, fig.height=5, fig.pos="center", digits=4)
\end_layout

\begin_layout Plain Layout

thisFileName <- "ARISTO-LAMS"
\end_layout

\begin_layout Plain Layout

require(Ranadu, quietly = TRUE, warn.conflicts=FALSE)
\end_layout

\begin_layout Plain Layout

require(ggplot2)
\end_layout

\begin_layout Plain Layout

require(grid)
\end_layout

\begin_layout Plain Layout

require(ggthemes)
\end_layout

\begin_layout Plain Layout

Directory <- DataDirectory ()
\end_layout

\begin_layout Plain Layout

Flight <- "rf03_LAMS" 				# XXX change this
\end_layout

\begin_layout Plain Layout

Project = "ARISTO"	
\end_layout

\begin_layout Plain Layout

ProjectDir <- "ARISTO"
\end_layout

\begin_layout Plain Layout

fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

VarList <- c("WDC", "WSC", "WIC", "AKRD", "SSRD", "U_LAMS", "V_LAMS", "W_LAMS",
\end_layout

\begin_layout Plain Layout

             "Beam1_LAMS", "Beam2_LAMS", "Beam3_LAMS", "Beam4_LAMS",  ##
 Scott's values
\end_layout

\begin_layout Plain Layout

             "BEAM1speed", "BEAM2speed", "BEAM3speed", "BEAM4speed", "ADIFR",
 "QCF", "BDIFR",
\end_layout

\begin_layout Plain Layout

             "CVEW_LAMS", "CVNS_LAMS", "CVSPD_LAMS", "GGVEW", "GGVNS",
\end_layout

\begin_layout Plain Layout

             "CTHDG_LAMS", "CROLL_LAMS", "CPITCH_LAMS", "PITCH", "ROLL",
 "THDG",
\end_layout

\begin_layout Plain Layout

             "WD_LAMS", "WS_LAMS", "WI_LAMS", "ATTACK_L", "SSLIP_L", "TASX")
\end_layout

\begin_layout Plain Layout

VarList <- c(VarList, 'PSFD', 'QCF', 'ADIFR', 'GGVSPD', 'EWX')
\end_layout

\begin_layout Plain Layout

ReloadData <- TRUE
\end_layout

\begin_layout Plain Layout

ReloadData <- FALSE
\end_layout

\begin_layout Plain Layout

SaveRData1 <- sprintf("%s1.Rdata", thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData1)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData1)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

PCA <- FALSE
\end_layout

\begin_layout Plain Layout

PCA <- TRUE  ## if set true, will use Spuler's PCA-algorithm beam speeds
\end_layout

\begin_layout Plain Layout

SummarizeFit <- function(ft) {
\end_layout

\begin_layout Plain Layout

  print (summary(ft)$call)
\end_layout

\begin_layout Plain Layout

  print ("Coefficients:")
\end_layout

\begin_layout Plain Layout

  print (summary(ft)$coefficients)
\end_layout

\begin_layout Plain Layout

  print (sprintf ("Residual standard deviation: %.3f, dof=%d", summary(ft)$sigma,
 summary(ft)$df[2]))
\end_layout

\begin_layout Plain Layout

  print (sprintf ("R-squared %.3f", summary(ft)$r.squared))
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
During the 2015 and 2016 ARISTO projects on the C-130, the LAMS was flown
 in a 4-beam configuration.
 The beam assignments were non-standard, though, with beam 2 forward, beam
 1 downward, beam 3 outboard and upward, and beam 4 inboard and upward.
 Beams 1, 3 and 4 were approximately 35
\begin_inset Formula $^{\circ}$
\end_inset

 from the forward direction, and relative to an azimuthal angle starting
 from the downward direction they were, respectively, 0, 
\begin_inset Formula $-120$
\end_inset

 and 120
\begin_inset Formula $^{\circ}$
\end_inset

 in clockwise rotation about the forward longitudinal axis.
 
\end_layout

\begin_layout Standard
There were five research flights in ARISTO-2015 and six in ARISTO-2016.
 Data from both projects are included in this memo, which is somewhat disorganiz
ed in that the discussions have not been merged well except in the conclusions.
 All flights had some degree of measurement problems, so data for this study
 have been selected from the periods that appear to provide the best measurement
s.
 The following table provides a few of the characteristics of these flights:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="12" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="left" valignment="top" width="5cm">
<column alignment="left" valignment="top" width="5cm">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
date
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
start
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
end
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
profile
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
problems
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150916
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160225
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200605
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
climb->20kft, level, stepped descent to BL, no maneuvers
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS IRU attitude angles bad
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150923
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
135907
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
204016
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
mostly low level until near end; LAMS reasonable, although weak; some speed
 variations
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
actual takeoff about 170000; BEAM2speed weak, BEAM2_LAMS (Scott's value)
 better.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150925
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
162500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
214500
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
both upper and lower-level legs; speed runs, some turbulence
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
CPITCH_LAMS bad before 192300, and CROLL also, so wind measurements from
 LAMS unavailable until after then.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150930
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
170100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
205000
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
good pitch and yaw maneuvers; also a partial speed run.
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Beams 1 and 4 problematic before 1915 in high-level leg; beam 2 probably
 useful for TAS.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
151002
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
143000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
184400
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
upper-level pitches and lower-level turbulence
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS beam peaks look very weak to me, questionable although SMS processing
 seems reasonable.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160802
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
162500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
183500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
profiles; no sign.
 cloud, no low-level & max ca.
 7 km
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS mostly good; some brief gaps.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160808
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
brief flight at low level
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
some beam-1 problems at low level
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160809
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
183235
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
some cold cloud near max altitude ca.
 7km; LAMS appears bad there.
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
some LAMS-beam gaps at upper level.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160810
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
134539
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
184016
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
only brief cold cloud; up to 5-6km.
 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS good
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160812
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
190000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203616
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
smoke-plume study; high CDP conc.
 in plumes.
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS good
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
160816
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
130138
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
264829
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long flight with near-sea-level leg for PCOR study; refueling stop at about
 1800–1900.
 Some low-level cloud near 1900–1930, with shorter cloud passes during return
 leg.
 Good short maneuvers also.
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS problems early after refueling and some also prior to descent for refueling
, esp.
 beam 2.
 Looks OK for critical part near 2100–0100.
 
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
For ARISTO-2015, the line-of-sight beam speeds were determined in two ways.
 Scott Spuler used principal-component analysis to find the beam speeds,
 and usually this worked very well, although there are some suspicious times.
 For example, the peaks in Flight 5 look very weak, yet the PCA method continued
 to find output values.
 Because there was tight coupling to the expected measured TAS (with adjustment
 for the beam angles), it appears suspicious that the method may be duplicating
 the TAS value at times without having an adequate signal.
 The match to TASX looks so good that it seems suspicious, as discussed
 later.
 A second method was to fit the background using Savitzgy-Golay polynomials
 and then search for peaks above this background.
 When signals were strong, the method usually produced the same result as
 the PCA method, but it was more prone to failure during periods where the
 signal was weak.
 (A signal-to-noise test of 
\begin_inset Formula $\geq4$
\end_inset

 was required for a valid measurement.) Results from both these peak-detecting
 algorithms will be discussed in this memo.
 
\end_layout

\begin_layout Standard
For ARISTO-2016, only the second method of processing was available at the
 time of this study, so results will all be based on the second method for
 that portion of the project.
\end_layout

\begin_layout Standard
There are several objectives that can be met by using the LAMS-derived measureme
nts:
\end_layout

\begin_layout Enumerate
The LAMS provides an independent measurement of angle-of-attack and sideslip
 angle, so these measurements can be used to check the empirical relationships
 used to calibrate the radome-based measurements of these angles.
\end_layout

\begin_layout Enumerate
LAMS provides an independent measurement of the airspeed, so from that measureme
nt it is possible to determine the expected dynamic pressure.
 This was used previously(Cooper et al., 2014) to calibrate not only the
 dynamic pressure but also the static pressure as measured on the C-130.
 However, since then the offset between the avionic static pressure and
 the research static pressure calibrated in this way has changed, so it
 is important to learn if the static defect actually changed or perhaps
 the avionic value changed.
 This has an important effect on the longitudinal component of the measured
 wind as well.
 ARISTO-2016, esp.
\begin_inset space ~
\end_inset

the last flight, provided an opportunity to extend the fit conditions to
 cover low-altitude flight of the C-130.
\end_layout

\begin_layout Enumerate
The paper by Cooper et al.
\begin_inset space ~
\end_inset

(2014) developed a method for measuring temperature using the LAMS, which
 might have potential to provide a valid measurement of temperature in clouds.
 However, only a small sample of measurements were available for use in
 that paper, so it will be useful to explore if further measurements from
 ARISTO help characterize this measurement.
\end_layout

\begin_layout Enumerate
The method used to calibrate the radome is based primarily on slowly varying
 measurements, such as the variation in angle-of-attack during a speed run.
 It is of concern that the calibration used might not apply in the case
 of rapidly changing flight conditions, when for example there might be
 transient adjustment of the airflow pattern toward a new steady state.
 Because the LAMS measures wind well ahead of the aircraft, such effects
 should not appear in the LAMS-based measurements, so a comparison of the
 LAMS-based and radome-based measurements might either identify transient-respon
se problems or place limits on how large such effects might be.
 Some rapid changes in pitch were included in the last flight of ARISTO-2016
 that can be used for this study.
\end_layout

\begin_layout Section
Data processing
\end_layout

\begin_layout Standard
The original netCDF files, with names like ARISTOrf01.nc, contain histograms
 of the LAMS frequency measurements, with names like BEAM{1–4}_LAMS.
 For ARISTO-2015, Scott Spuler has processed these to produce files like
 ARISTOrf01_LAMS.nc with new variables Beam{1–4}_LAMS containing the line-of-sigh
t speeds measured in each beam.
 In addition, the Python program LAMS_ARISTO.py has been used to process
 these further to files ARISTOrfxx_LAMSLAMS.nc, which contain additional
 variables BEAM{1–4}speed also representing the line-of-sight speeds.
 Only the latter processing has been performed for ARISTO-2016, for which
 the resulting files have names like ARISTO2016rfxxLAMS.nc.
 Both sets of variables, Beam{1–4}_LAMS and BEAM{1–4}speed, will be used
 below when available but they appear to have different strengths:
\end_layout

\begin_layout Enumerate
The variables Beam{1–4}_LAMS are produced by Spuler's PCA routine.
 This is the most sensitive detection method, but there is some suspicion
 that it produces values when there is inadequate signal, perhaps by too
 much reliance on TASX to determine where the peak should be.
 
\end_layout

\begin_layout Enumerate
The variables BEAM{1–4}speed are produced by smoothing the histograms with
 Savitzgy-Golay polynomials and then searching for peaks above the smoothed
 background.
 This algorithm also uses TASX to determine likely locations for the peaks,
 but with a fairly large tolerance, and it requires a signal-to-noise ratio
 
\begin_inset Formula $\geq4$
\end_inset

 or else it produces a missing-value result.
 In ARISTO2015, this algorithm was significantly less sensitive than the
 PCA algorithm, and for example in Flight 5 it mostly did not produce useful
 results while the PCA algorithm produced almost continuous results for
 the line-of-sight beam speeds.
\end_layout

\begin_layout Standard
The Python routine also produced new variables named WD_LAMS, WS_LAMS, WI_LAMS,
 ATTACK_L and SSLIP_L, using the processing algorithms for a 4-beam LAMS
 that were discussed in the documents LAMSprocessing4Bwind.pdf and LAMSprocessing
3Dwind.pdf.
 However, these variables were not used in the study reported here.
 Instead, all variables derived from the line-of-sight LAMS measurements
 were recalculated in the present R routine (this file) to generate measurements
 of vertical and horizontal wind, airspeed, and angles of attack and sideslip.
 For airspeed, angle of attack, and sideslip, these steps were used:
\end_layout

\begin_layout Enumerate
The four-beam measurements were used to determine a three-dimensional relative
 wind vector 
\series bold
RW
\series default
={
\begin_inset Formula $\mathrm{RW}_{x},\,\mathrm{RW}_{y},\,\mathrm{RW_{z}}$
\end_inset

}
\series bold
 
\series default
with components inbound along the longitudinal forward, lateral starboard,
 and lateral downward axis in the coordinate frame of the LAMS IRU (with
 attitude angles CPITCH, CROLL, CTHDG).
 The algorithm is documented in LAMSprocessing4Bwind.pdf.
 
\end_layout

\begin_layout Enumerate
The airspeed is then the magnitude of the vector 
\series bold
RW
\series default
.
\end_layout

\begin_layout Enumerate
The angle of attack is 
\begin_inset Formula $\alpha=\arctan\left(\mathrm{RW}_{z}/\mathrm{RW}_{x}\right)$
\end_inset

 and the sideslip angle is 
\begin_inset Formula $\beta=\arctan\left(\mathrm{RW}_{y}/\mathrm{RW}_{x}\right)$
\end_inset

.
 
\end_layout

\begin_layout Standard
For measurements of wind, the Ranadu routine Ranadu::WindProcessor() was
 used to calculate the wind based on LAMS-based variables for airspeed,
 angle of attack, and sideslip and the INS-provided attitude angles, with
 complementary-filter adjustment of the INS-provided groundspeed components
 based on the corresponding GPS-provided measurements.
\end_layout

\begin_layout Standard
For completeness, here are suggested procedures for using the Python routine
 LAMS_ARISTO.py, with comments regarding future use with new data files:
\end_layout

\begin_layout Enumerate
On tikal, copy the routine ~cooperw/LAMS/LAMS_ARISTO.py to another directory
 where you have write permission.
\end_layout

\begin_layout Enumerate
On lines 252 and 253, change the names of the data file and the directory
 containing the file to be processed.
 Do not include the trailing 
\begin_inset Quotes eld
\end_inset

.nc
\begin_inset Quotes erd
\end_inset

 in the file name, and if the file already contains Scott Spuler's processing
 add 
\begin_inset Quotes eld
\end_inset

_LAMS
\begin_inset Quotes erd
\end_inset

 to the file name as on line 251.
 Save the edited file.
 CAUTION: This routine will create a new file in that same directory with
 
\begin_inset Quotes eld
\end_inset

LAMS
\begin_inset Quotes erd
\end_inset

 appended to the name supplied, and if that file is present it will overwrite
 the file.
 This won't overwrite Scott's files because it adds 
\begin_inset Quotes eld
\end_inset

LAMS
\begin_inset Quotes erd
\end_inset

 instead of 
\begin_inset Quotes eld
\end_inset

_LAMS
\begin_inset Quotes erd
\end_inset

, but if Scott's files are used the new file will end in 
\begin_inset Quotes eld
\end_inset

_LAMSLAMS
\begin_inset Quotes erd
\end_inset

.
 In that case, the new file will contain the line-of-sight speeds obtained
 by both algorithms, in Scott's case with the names Beam1_LAMS – Beam4_LAMS
 and in the case of the Python program with names BEAM1speed – BEAM4speed.
\end_layout

\begin_layout Enumerate
Run the program using the command 
\begin_inset Quotes eld
\end_inset

python LAMS_ARISTO.py
\begin_inset Quotes erd
\end_inset

.
 There will be regular messages during processing, ending (if successful)
 with the message 
\begin_inset Quotes eld
\end_inset

Reached end of routine ...
\begin_inset Quotes erd
\end_inset

.
 This will typically take a few minutes.
 If this fails immediately, there may be a problem with the available python
 packages that need updating or changing.
\end_layout

\begin_layout Enumerate
On successful completion, there should then be a new file with a name ending
 in 
\begin_inset Quotes eld
\end_inset

LAMS.nc
\begin_inset Quotes erd
\end_inset

 in the prescribed working directory.
 It should be slightly larger than the original file because a few variables
 are added containing the line-of-sight LAMS speeds and some derived quantities.
 These are then the netCDF files that are read by the next routine to produce
 the final document,.
\end_layout

\begin_layout Standard
The next step is then to run the present routine, 
\begin_inset Quotes eld
\end_inset

ARISTO-LAMS.Rnw
\begin_inset Quotes erd
\end_inset

, in RStudio to generate the PDF document.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<beam-processing, echo=FALSE, include=TRUE, fig.cap='Wind measurements:
 conventional (blue), PCA-based (green), SG-based (red).
 The time period is restricted to 19:23--21:30 UTC because the LAMS IRU
 produced erronous values for the attitude angles at other times.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

processWind <- function(Data) {
\end_layout

\begin_layout Plain Layout

  Data$BEAM1speed <- zoo::na.approx (as.vector(Data$BEAM1speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM2speed <- zoo::na.approx (as.vector(Data$BEAM2speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM3speed <- zoo::na.approx (as.vector(Data$BEAM3speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM4speed <- zoo::na.approx (as.vector(Data$BEAM4speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  ## replace with Scott's values
\end_layout

\begin_layout Plain Layout

  if (PCA) {
\end_layout

\begin_layout Plain Layout

    Data$BEAM1speed <- zoo::na.approx (as.vector(Data$Beam1_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM2speed <- zoo::na.approx (as.vector(Data$Beam2_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM3speed <- zoo::na.approx (as.vector(Data$Beam3_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM4speed <- zoo::na.approx (as.vector(Data$Beam4_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  ## try to fix CTHDG_LAMS bad points in transition through 180: (may no
 longer be needed)
\end_layout

\begin_layout Plain Layout

  for (i in 2:(nrow(Data)-1)) {
\end_layout

\begin_layout Plain Layout

    if (is.na(Data$CTHDG_LAMS[i]) || is.na(Data$CTHDG_LAMS[i-1]) || is.na(Data$CTHD
G_LAMS[i+1])) {next}
\end_layout

\begin_layout Plain Layout

    if (abs(Data$CTHDG[i-1]-Data$CTHDG_LAMS[i+1]) > 10.) {next}
\end_layout

\begin_layout Plain Layout

    if ((Data$CTHDG_LAMS[i-1] < 180.) && (Data$CTHDG_LAMS[i+1] > 180)) {Data$CTHD
G_LAMS[i] <- NA}
\end_layout

\begin_layout Plain Layout

    if ((Data$CTHDG_LAMS[i-1] > 180.) && (Data$CTHDG_LAMS[i+1] < 180)) {Data$CTHD
G_LAMS[i] <- NA}
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  Data$CTHDG_LAMS <- zoo::na.approx (as.vector(Data$CTHDG_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  Theta =  c(35.0802, 34.8501, 34.8496, 0.) * pi / 180 # revised 12 May 2014
\end_layout

\begin_layout Plain Layout

  Theta <- c(35, 0, 35, 35) * pi / 180  ## ARISTO
\end_layout

\begin_layout Plain Layout

  Phi = c(179.2171, -61.0712, 59.1506, 0.) * pi / 180  #  "  "
\end_layout

\begin_layout Plain Layout

  Phi = c(0, 0, -120, 120) * pi / 180
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  # also need the distances from the IRS to LAMS: (x,y,z)
\end_layout

\begin_layout Plain Layout

  LL = c(-10.305, -6.319, 1.359)                # these are GV values; need
 C130 values
\end_layout

\begin_layout Plain Layout

  # unit vectors along beams are then:
\end_layout

\begin_layout Plain Layout

  #   a[i] = [cos(Theta[i]), -sin(Theta[i])*sin(Phi[i]), sin(Theta[i])*cos(Phi[i
])]
\end_layout

\begin_layout Plain Layout

  # and the dot products with the (i,j,k) unit vectors give the direction
 cosine matrix:
\end_layout

\begin_layout Plain Layout

  S = c(cos(Theta[1]), -sin(Theta[1])*sin(Phi[1]), sin(Theta[1])*cos(Phi[1]),
 
\end_layout

\begin_layout Plain Layout

                 cos(Theta[2]), -sin(Theta[2])*sin(Phi[2]), sin(Theta[2])*cos(Ph
i[2]), 
\end_layout

\begin_layout Plain Layout

                 cos(Theta[3]), -sin(Theta[3])*sin(Phi[3]), sin(Theta[3])*cos(Ph
i[3]))
\end_layout

\begin_layout Plain Layout

  S4 <- c(S, cos(Theta[4]), -sin(Theta[4])*sin(Phi[4]), sin(Theta[4])*cos(Phi[4]
))
\end_layout

\begin_layout Plain Layout

  dim(S) <- c(3,3)
\end_layout

\begin_layout Plain Layout

  Si = t(solve(S))  # calculate the inverse of S -- this is the 3-beam version
\end_layout

\begin_layout Plain Layout

  ## the following commented lines are the python code:
\end_layout

\begin_layout Plain Layout

  # S4 = np.vstack ((S, [cos(Theta[3]), -sin(Theta[3])*sin(Phi[3]), sin(Theta[3])
*cos(Phi[3])]))
\end_layout

\begin_layout Plain Layout

  # StS =  linalg.inv (ma.dot (S4.T, S4))
\end_layout

\begin_layout Plain Layout

  # M = ma.dot (StS, S4.T)      # matrix for finding relative wind from 4-beam
 LAMS
\end_layout

\begin_layout Plain Layout

  dim(S4) <- c(3,4)
\end_layout

\begin_layout Plain Layout

  StS <- S4 %*% t(S4)
\end_layout

\begin_layout Plain Layout

  StS <- solve(StS)
\end_layout

\begin_layout Plain Layout

  M <- StS %*% S4
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  A = c(Data$BEAM1speed, Data$BEAM2speed, Data$BEAM3speed)
\end_layout

\begin_layout Plain Layout

  A4 <- c(A, Data$BEAM4speed)
\end_layout

\begin_layout Plain Layout

  dim(A4) <- c(nrow(Data), 4)
\end_layout

\begin_layout Plain Layout

  dim(A) <- c(nrow(Data), 3)
\end_layout

\begin_layout Plain Layout

  RW = t (Si %*% t(A))    # gives u, v, w components, RW[,1] is u
\end_layout

\begin_layout Plain Layout

  RW2 <- t (M %*% t(A4))
\end_layout

\begin_layout Plain Layout

  ## calculate the error in the solution:
\end_layout

\begin_layout Plain Layout

  A4P <- t (t (S4) %*% t (RW2)) - A4
\end_layout

\begin_layout Plain Layout

  CSQ <- A4P[,1]^2 + A4P[,2]^2 + A4P[,3]^2 + A4P[,4]^2
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  ## set up special data.frame for calculation of wind:
\end_layout

\begin_layout Plain Layout

  D <- data.frame("Time"=Data$Time)
\end_layout

\begin_layout Plain Layout

  D$TASX <- sqrt(RW2[,1]^2 + RW2[,2]^2 + RW2[,3]^2)
\end_layout

\begin_layout Plain Layout

  D$TASX3 <- sqrt(RW[,1]^2 + RW[,2]^2 + RW[,3]^2)
\end_layout

\begin_layout Plain Layout

  D$TASCSQ <- CSQ 
\end_layout

\begin_layout Plain Layout

  D$ATTACK <- atan (RW2[, 3] / RW2[, 1]) * 180 / pi
\end_layout

\begin_layout Plain Layout

  D$SSLIP <-  atan (RW2[, 2] / RW2[, 1]) * 180 / pi
\end_layout

\begin_layout Plain Layout

  D$GGVEW <- Data$CVEW_LAMS
\end_layout

\begin_layout Plain Layout

  D$GGVNS <- Data$CVNS_LAMS
\end_layout

\begin_layout Plain Layout

  D$GGVSPD <- Data$CVSPD_LAMS
\end_layout

\begin_layout Plain Layout

  D$VEW <- Data$CVEW_LAMS
\end_layout

\begin_layout Plain Layout

  D$VNS <- Data$CVNS_LAMS
\end_layout

\begin_layout Plain Layout

  D$THDG <- Data$CTHDG_LAMS
\end_layout

\begin_layout Plain Layout

  D$ROLL <- Data$CROLL_LAMS
\end_layout

\begin_layout Plain Layout

  D$PITCH <- Data$CPITCH_LAMS
\end_layout

\begin_layout Plain Layout

  ## save some variables for ease of plotting:
\end_layout

\begin_layout Plain Layout

  D$BEAM1speed <- Data$BEAM1speed
\end_layout

\begin_layout Plain Layout

  D$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

  D$BEAM3speed <- Data$BEAM3speed
\end_layout

\begin_layout Plain Layout

  D$BEAM4speed <- Data$BEAM4speed
\end_layout

\begin_layout Plain Layout

  D$WDC <- Data$WDC
\end_layout

\begin_layout Plain Layout

  D$WSC <- Data$WSC
\end_layout

\begin_layout Plain Layout

  D$WIC <- Data$WIC
\end_layout

\begin_layout Plain Layout

  D$WD_LAMS <- Data$WD_LAMS
\end_layout

\begin_layout Plain Layout

  D$WS_LAMS <- Data$WS_LAMS
\end_layout

\begin_layout Plain Layout

  D$WI_LAMS <- Data$WI_LAMS
\end_layout

\begin_layout Plain Layout

  D$AKRD <- Data$AKRD
\end_layout

\begin_layout Plain Layout

  D$SSRD <- Data$SSRD
\end_layout

\begin_layout Plain Layout

  D$ADIFR <- Data$ADIFR
\end_layout

\begin_layout Plain Layout

  D$QCF <- Data$QCF
\end_layout

\begin_layout Plain Layout

  D$GGVSPD <- Data$GGVSPD
\end_layout

\begin_layout Plain Layout

  D$PSFD <- Data$PSFD
\end_layout

\begin_layout Plain Layout

  D$EWX <- Data$EWX
\end_layout

\begin_layout Plain Layout

  # if (grepl('rf03', fname)) {
\end_layout

\begin_layout Plain Layout

  #   rg <- setRange (D$Time, 192300,213000)
\end_layout

\begin_layout Plain Layout

  #   D <- D[rg, ]
\end_layout

\begin_layout Plain Layout

  # }
\end_layout

\begin_layout Plain Layout

  ## use standard wind processor 
\end_layout

\begin_layout Plain Layout

  ### rotation-rate corrections should be removed first, 
\end_layout

\begin_layout Plain Layout

  ### but for standard routine they are insignificant so will be ignored.
\end_layout

\begin_layout Plain Layout

  DW <- WindProcessor (data=D)
\end_layout

\begin_layout Plain Layout

  return (DW)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind (Data)
\end_layout

\begin_layout Plain Layout

rg <- setRange (DW, 192300, 213000)
\end_layout

\begin_layout Plain Layout

DW <- DW[rg,]  ## select time when LAMS IRU was working
\end_layout

\begin_layout Plain Layout

layout(matrix(1:3, ncol = 1), widths = 1,  heights = c(5,5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

plotWAC(DW[c("Time", "WDC", "WDN", 'WD_LAMS')], legend.position='bottom')
  #, ylim=c(250,360)
\end_layout

\begin_layout Plain Layout

title(fname)
\end_layout

\begin_layout Plain Layout

plotWAC(DW[c("Time", "WSC", "WSN", 'WS_LAMS')], ylim=c(0,40), legend.position='to
pright')
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

plotWAC(DW[c("Time", "WIC", "WIN", 'WI_LAMS')], ylim=c(-5,5), legend.position='to
p')
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Some results for the various processing schemes are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:beam-processing}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
\noindent
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Section
Sensitivity coefficients
\end_layout

\begin_layout Subsection
Angle of attack
\begin_inset CommandInset label
LatexCommand label
name "subsec:Angle-of-attack"

\end_inset


\end_layout

\begin_layout Standard
The following speed-run maneuvers are available from ARISTO2015:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
#
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
flight
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
start
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
end
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
comments
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
183200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
185500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PCA, not SG
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
193800
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PCA or (SG exc 193000)
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
171300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
173800
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
CPITCH bad
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
183400
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
185700
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
CPITCH bad
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
205500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
210000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
slowdown only; PCA only
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
174300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
180700
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PCA only
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
191200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
193000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PCA only; SG weak
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
202500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203900
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PCA; SG B1 weak
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
The values of vertical wind as originally processed did not look very good,
 so the first step was to determine a conventional set of sensitivity coefficien
ts to use as a radome calibration.
 For this purpose, a data.frame consisting of a concatenation of the eight
 speed runs in the preceding table was constructed and a reference value
 for calibration (AOAREF) was added to the data.frame.
 AOAREF, defined below, is the value that should be measured for angle of
 attack if the true vertical wind is zero during the maneuver:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathrm{AOAREF}=\theta+\frac{w_{p}}{V}\frac{180}{\pi}\label{eq:aoaref}
\end{equation}

\end_inset

where 
\begin_inset Formula $\theta$
\end_inset

 is the pitch angle (variable PITCH), 
\begin_inset Formula $w_{p}$
\end_inset

 is the rate of climb of the aircraft (variable GGVSPD), and 
\begin_inset Formula $V$
\end_inset

 is the true airspeed (variable TASX).
 The conventional fit is then
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathrm{AOAREF}=c_{0}+\frac{\mathrm{ADIFR}}{\mathrm{QCF}}\left(c_{1}+c_{2}\thinspace\mathrm{MACH}\right)\label{eq:akrd-fit}
\end{equation}

\end_inset

where 
\begin_inset Formula $\mathrm{MACH}$
\end_inset

 is the Mach number determined from the uncorrected measurements PSFD and
 QCF (cf.
\begin_inset space ~
\end_inset

the technical note on processing algorithms).
 In addition, a data.frame consisting of all measurements from flights 2–4
 was constructed and coefficients were also determined for a fit to those
 data.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<All-flight-cal, include=TRUE, fig.cap='', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData3 <- sprintf ('%s3.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (sprintf ('%sARISTO/ARISTOrf02_LAMSLAMS.nc', Directory),
 VarList, F=2)
\end_layout

\begin_layout Plain Layout

  Data <- rbind(Data, getNetCDF (sprintf ('%sARISTO/ARISTOrf03_LAMSLAMS.nc',
 Directory), VarList, F=3))
\end_layout

\begin_layout Plain Layout

  Data <- rbind(Data, getNetCDF (sprintf ('%sARISTO/ARISTOrf04_LAMSLAMS.nc',
 Directory), VarList, F=4))
\end_layout

\begin_layout Plain Layout

  rej <- (Data$TASX < 90) | (abs(Data$ROLL) > 5) | (abs(Data$GGVSPD) > 5)
\end_layout

\begin_layout Plain Layout

  Data <- Data[!rej,]
\end_layout

\begin_layout Plain Layout

  Data$AOAREF <- Data$PITCH - (Data$GGVSPD / Data$TASX) * (180./pi)
\end_layout

\begin_layout Plain Layout

  Data$QR <- Data$ADIFR / Data$QCF
\end_layout

\begin_layout Plain Layout

  Data$Mach <- MachNumber (Data$PSFD, Data$QCF, Data$EWX)
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData3)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData3)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

fff <- lm (AOAREF ~ QR + I(QR*Mach), data=Data)
\end_layout

\begin_layout Plain Layout

cfall <- coef (fff)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<ConventionalCoef, include=TRUE, fig.cap='Angle of attack from the new calibrati
on vs.
 the corresponding value of the reference variable AOAREF.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData4 <- sprintf ('%s4.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf02_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  SRD <- getNetCDF (fname, standardVariables(c(VarList)), Start=183200,
 End=185500, F=2)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=192100,
 End=193800, F=2)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  Flight <- "rf03_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=171300,
 End=173800, F=3)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=183400,
 End=185700, F=3)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=205500,
 End=210000, F=3)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  Flight <- "rf04_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=174300,
 End=180700, F=4)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=191200,
 End=193000, F=4)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  SR  <- getNetCDF (fname, standardVariables(c(VarList)), Start=202500,
 End=203900, F=4)
\end_layout

\begin_layout Plain Layout

  SRD <- rbind (SRD, SR)
\end_layout

\begin_layout Plain Layout

  SRD$AOAREF <- SRD$PITCH - (SRD$GGVSPD / SRD$TASX) * (180 / pi)
\end_layout

\begin_layout Plain Layout

  SRD$QR <- SRD$ADIFR / SRD$QCF
\end_layout

\begin_layout Plain Layout

  SRD$Mach <- MachNumber (SRD$PSFD, SRD$QCF, SRD$EWX)
\end_layout

\begin_layout Plain Layout

  save (SRD, file=SaveRData4)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData4)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

f <- lm (AOAREF~QR+I(QR*Mach), data=SRD)
\end_layout

\begin_layout Plain Layout

cf <- coefficients(f)
\end_layout

\begin_layout Plain Layout

f2 <- lm (AOAREF~QR+I(QR*Mach), data=SRD[SRD$RF == 2,])
\end_layout

\begin_layout Plain Layout

cf2 <- coefficients(f2)
\end_layout

\begin_layout Plain Layout

f3 <- lm (AOAREF~QR+I(QR*Mach), data=SRD[SRD$RF == 3,])
\end_layout

\begin_layout Plain Layout

cf3 <- coefficients(f3)
\end_layout

\begin_layout Plain Layout

f4 <- lm (AOAREF~QR+I(QR*Mach), data=SRD[SRD$RF == 4,])
\end_layout

\begin_layout Plain Layout

cf4 <- coefficients(f4)
\end_layout

\begin_layout Plain Layout

SRD$AKRDF <- cf[1] + cf[2] * SRD$QR + cf[3] * SRD$QR * SRD$Mach
\end_layout

\begin_layout Plain Layout

layout(matrix(1:1, ncol = 1), widths = 1,  heights = c(6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(SRD$AOAREF, SRD$AKRDF), xlab='reference value AOAREF',
 pch=20, type='p')
\end_layout

\begin_layout Plain Layout

lines (c(-2,5), c(-2,5), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:ConventionalCoef}
\end_layout

\end_inset

 shows the resulting fit, with coefficients {
\begin_inset Formula $c_{0},\,c_{1},\,c_{2}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[2], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[3], 4)}
\end_layout

\end_inset

}.
 However, the results differed for the three flights, and the differences
 were significant, as shown in the following table:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Flight
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{0}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{2}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
speed runs
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[1], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[2], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[3], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
all rf02–04
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfall[1], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfall[2], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfall[3], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[1], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[2], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[3], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf3[1], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf3[2], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf3[3], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf4[1], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf4[2], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf4[3], 4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\noindent
Therefore, the individual-flight coefficients will be used to determine
 AKRD and hence WIC in the following studies in this report.
\end_layout

\begin_layout Standard
An additional adjustment of the measurements is useful because the LAMS
 is not installed parallel to the centerline of the aircraft.
 For example, the average measurement of pitch from the LAMS IRU, CPITCH_LAMS,
 is 1.0
\begin_inset Formula $^{\circ}$
\end_inset

 larger than the corresponding measurement of pitch from the Honeywell IRU.
 To account for this offset, it is useful to correct both the pitch and
 angle-of-attack from LAMS by the subtraction of 1.0
\begin_inset Formula $^{\circ}$
\end_inset

 so that the measurements will be comparable to those from the standard
 radome-based system.
 That correction has been made in the following when the LAMS-based angle-of-att
ack is discussed.
\end_layout

\begin_layout Standard
With these corrections, the standard angle-of-attack can be compared to
 that determined from the LAMS.
 The first speed run in the table above will be skipped here because there
 are too many bad measurements from LAMS.
 For the second speed run, Figure
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR2}
\end_layout

\end_inset

 shows the comparison of the two angles of attack.
 There is a clear difference between the two measurements.
 Speed runs #3 and #5 have too much scatter in the LAMS measurements to
 be useful, but speed run #4 has apparently good measurements as shown in
 Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR4}
\end_layout

\end_inset

.
 Here the scatter is much higher than in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR2}
\end_layout

\end_inset

 because this is a low-level flight segment in boundary-layer turbulence,
 but the measurements still show an offset like that in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR2}
\end_layout

\end_inset

, although perhaps with a smaller offset.
 Speed runs #6 and #8 have high scatter and are inconsistent with other
 apparently good speed runs, but speed run #7 led to good agreement between
 the values of the radome-based and LAMS-based angles of attack, as shown
 in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR7}
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<SR2, include=TRUE, fig.cap='Angle of attack from the new fit to the radome
 values, plotted against the corresponding anagle-of-attack as measured
 by the LAMS, for speed run 
\backslash

\backslash
#2.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData5 <- sprintf ('%s5.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf02_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData5)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData5)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf2[1] + DW$ADIFR/DW$QCF * (cf2[2] + cf2[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

#r <- setRange (DW, 183200, 185500)
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 192100, 193800)
\end_layout

\begin_layout Plain Layout

DW$ATTACK <- DW$ATTACK - 1
\end_layout

\begin_layout Plain Layout

DW$ATTACK[abs(DW$ATTACK-DW$AKRDF) > 1] <- NA
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSFD, DW$QCF, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$AOAREF <- Data$PITCH - (Data$GGVSPD / Data$TASX) * (180 / pi)
\end_layout

\begin_layout Plain Layout

fl2 <- lm (ATTACK ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

fa2 <- lm (AOAREF ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

cfl2 <- coef (fl2)
\end_layout

\begin_layout Plain Layout

cfa2 <- coef (fa2)
\end_layout

\begin_layout Plain Layout

DWS <- DW[r,]
\end_layout

\begin_layout Plain Layout

DWS$RF <- rep (2, nrow(DWS))
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$ATTACK[r], DW$AKRDF[r]), xlab='LAMS-based angle of
 attack',
\end_layout

\begin_layout Plain Layout

        ylab='new fit for radome-based angle of attack', pch=20, type='p',
 xlim=c(-2,5),
\end_layout

\begin_layout Plain Layout

        ylim=c(-2,5))
\end_layout

\begin_layout Plain Layout

lines (c(-2,5), c(-2,5), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<SR4, include=TRUE, fig.cap='Angle of attack from the new fit to the radome
 values, plotted against the corresponding anagle-of-attack as measured
 by the LAMS, for speed run 
\backslash

\backslash
#4.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData6 <- sprintf ('%s6.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf03_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData6)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData6)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf3[1] + DW$ADIFR/DW$QCF * (cf3[2] + cf3[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

#r <- setRange (DW, 183200, 185500)
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 171300, 173800)
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 183400, 185700)
\end_layout

\begin_layout Plain Layout

DW$ATTACK <- DW$ATTACK - 1
\end_layout

\begin_layout Plain Layout

DW$ATTACK[abs(DW$ATTACK-DW$AKRDF) > 4] <- NA
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSFD, DW$QCF, DW$EWX)
\end_layout

\begin_layout Plain Layout

fl4 <- lm (ATTACK ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$ATTACK[r], DW$AKRDF[r]), xlab='LAMS-based angle of
 attack',
\end_layout

\begin_layout Plain Layout

        ylab='new fit for radome-based angle of attack', pch=20, type='p',
 xlim=c(-2,5),
\end_layout

\begin_layout Plain Layout

        ylim=c(-2,5))
\end_layout

\begin_layout Plain Layout

lines (c(-2,5), c(-2,5), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<SR7, include=TRUE, fig.cap='Angle of attack from the new fit to the radome
 values, plotted against the corresponding anagle-of-attack as measured
 by the LAMS, for speed run 
\backslash

\backslash
#7.
 Some additional outlier points having difference between the measurements
 larger than 1 degree have been excluded from the plot.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData7 <- sprintf ('%s7.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf04_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData7)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData7)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 191200, 193000)
\end_layout

\begin_layout Plain Layout

DW$ATTACK <- DW$ATTACK - 1
\end_layout

\begin_layout Plain Layout

DW$ATTACK[abs(DW$ATTACK-DW$AKRDF) > 1] <- NA
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSFD, DW$QCF, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$AOAREF <- Data$PITCH - (Data$GGVSPD / Data$TASX) * (180 / pi)
\end_layout

\begin_layout Plain Layout

fl7 <- lm (ATTACK ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

fa7 <- lm (AOAREF ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

cfl7 <- coef (fl7)
\end_layout

\begin_layout Plain Layout

cfa7 <- coef (fa7)
\end_layout

\begin_layout Plain Layout

DW$RF <- rep (7, nrow(DW))
\end_layout

\begin_layout Plain Layout

DWS <- rbind (DWS, DW[r,])
\end_layout

\begin_layout Plain Layout

fl <- lm (ATTACK ~ QR + I(QR*Mach), data=DWS)
\end_layout

\begin_layout Plain Layout

cfl <- coef (fl)
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$ATTACK[r], DW$AKRDF[r]), xlab='LAMS-based angle of
 attack',
\end_layout

\begin_layout Plain Layout

        ylab='new fit for radome-based angle of attack', pch=20, type='p',
 xlim=c(-2,5),
\end_layout

\begin_layout Plain Layout

        ylim=c(-2,5))
\end_layout

\begin_layout Plain Layout

lines (c(-2,5), c(-2,5), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

DSR <- DW[r, ]    ## save this for later use
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figures 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR2}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR7}
\end_layout

\end_inset

 show reasonable consistency between the two measurements, while there is
 a significant offset evident in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR4}
\end_layout

\end_inset

.
 Because speed run #4 is a low-level boundary-layer leg, there may be bias
 introduced by the proximity of the ground and strong reflection from it
 that could affect the downward-pointing beam.
 A fit to the radome-based angle of attack as a function of the LAMS-based
 value gave regression coefficients of 0.66 (offset) and 0.70 (slope), so
 these measurements are clearly inconsistent.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard
A revised LAMS-based calibration for the radome sensitivity coefficients
 can then be determined by using the LAMS-based angle of attack as the reference
 for the fits.
 Separate fits for speed-run #2 and for #7 produced significantly different
 results, so both the conventional and LAMS-based calibrations differ for
 the two speed runs.
 The following table summarizes the results:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
speed run
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
source of calibration
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{0}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{2}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
AOAREF
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfa2[1],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfa2[2],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS ATTACK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl2[1],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl2[2],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
AOAREF
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfa7[1],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfa7[2],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS ATTACK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl7[1],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl7[2],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#2+#7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS ATTACK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[1],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[2],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[3],4)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<summary-plot,include=TRUE, fig.cap="Comparison of the standard and LAMS-based
 calibrations for speed run 
\backslash

\backslash
#7.", cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

xx <- -0.5 + (1.3-0.5) / 40 * (0:41)
\end_layout

\begin_layout Plain Layout

yyl7 <- cfl7[1] +cfl7[2]*xx
\end_layout

\begin_layout Plain Layout

yyl2 <- cfl2[1] +cfl2[2]*xx
\end_layout

\begin_layout Plain Layout

yya7 <- cfa7[1] +cfa7[2]*xx
\end_layout

\begin_layout Plain Layout

yya2 <- cfa2[1] +cfa2[2]*xx
\end_layout

\begin_layout Plain Layout

dfp <- data.frame (xx, 'standard SR7'=yya7, 'LAMS SR7'=yyl7, 'standard SR2'=yya2,
 'LAMS SR2'=yyl2)
\end_layout

\begin_layout Plain Layout

plotWAC(dfp, xlab='ADIFR/QCF', ylab='angle of attack',type='l', 
\end_layout

\begin_layout Plain Layout

        col=c('blue', 'red', 'darkgreen', 'black'),
\end_layout

\begin_layout Plain Layout

        lwd=c(2,3,2,3), lty=c(1,3,1,3), legend.position='topleft')
\end_layout

\begin_layout Plain Layout

# lineWAC(xx, yyl2, col='darkgreen', lwd=2)
\end_layout

\begin_layout Plain Layout

# lineWAC(xx,yya2, col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

# legend('topleft', c('standard', 'LAMS'), col=c('blue', 'red'), lty=c(1,2),
 lwd=c(2,3))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The four calibrations in the preceding table are plotted in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:summary-plot}
\end_layout

\end_inset

.
 For speed run #7, the calibrations based on LAMS and on AOAREF are close
 to the same, although there are small differences of typical magnitude
 of about 0.1
\begin_inset Formula $^{\circ}$
\end_inset

for angles-of-attack in the typical range of operations (0–4
\begin_inset Formula $^{\circ}$
\end_inset

).
 However, the different calibrations for speed run #2 are not as consistent,
 and both calibrations differ significantly from those for speed run #7.
 A fit to the combined data from #2 and #7 is also shown for the LAMS calibratio
n, but this fit was much worse than the individual-flight calibrations and
 showed two distinct lines with little overlap for the two plots, so this
 is not a good calibration to use for these flights.
 For the conventional calibration, the differencemight be attributed to
 a non-zero vertical wind during the calibration maneuver, but the LAMS
 calibration is not affected by the vertical wind so it should be definitive
 unless there was some problem with detection of the LAMS beams.
 Other possibilities are drift of the CPITCH_LAMS measurement or differences
 in altitude or Mach number.
 However, the difference between PITCH and CPITCH_LAMS is the same for speed
 run #2 as for speed run #7 and both were flown at almost the same altitude
 and range in Mach number, so these explanations appear to be ruled out.
 
\end_layout

\begin_layout Standard
The result is that the two best speed runs, #2 and #7, are inconsistent.
 Calibrations for speed run #7 support the validity of each, but there is
 larger than expected difference between the two calibrations for #2 and
 between the corresponding calibrations for #7 vs #2.
 These are the best calibration data available, so more measurements with
 adequate LAMS signal-to-noise would be valuable.
 Pending such measurements, the LAMS-based calibration for #7 may be the
 most reliable.
\end_layout

\begin_layout Standard
Another conclusion from the study of the speed runs is that the PCA analysis
 does not always produce reliable line-of-sight speeds.
 A good example is speed run #6.
 There are values for all four beam line-of-sight speeds through this maneuver,
 and the speed in the forward beam (Beam 2) matches the true airspeed (TASX)
 well.
 However, Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:SR6}
\end_layout

\end_inset

 shows that the angle-of-attack determined from these measurements does
 not match that determined from the radome-based system and looks very noisy.
 This raises a warning that sometimes the line-of-sight speeds are not valid
 even when the PCA algorithm detects peak values.
 
\end_layout

\begin_layout Standard
See also Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:aoa-r6-2016"

\end_inset

, where sensitivity coefficients are determined from the last ARISTO-2016
 flight.
 These are based on the widest range of flight conditions and are suggested
 as the best for general use for C-130 projects since 2011.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<SR6, include=TRUE, fig.cap='Angle of attack from the new fit to the radome
 values (blue line) and the angle-of-attack determined from the LAMS measurement
s (green line), for speed run 
\backslash

\backslash
#6.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRData8 <- sprintf ('%s8.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf04_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory, ProjectDir, Project, Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRData8)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData8)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf3[1] + DW$ADIFR/DW$QCF * (cf3[2] + cf3[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

#r <- setRange (DW, 183200, 185500)
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 174300, 180700)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 183400, 185700)
\end_layout

\begin_layout Plain Layout

DW$ATTACK <- DW$ATTACK - 1
\end_layout

\begin_layout Plain Layout

DW$ATTACK[abs(DW$ATTACK-DW$AKRDF) > 4] <- NA
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSFD, DW$QCF, DW$EWX)
\end_layout

\begin_layout Plain Layout

fl4 <- lm (ATTACK ~ QR, data=DW[r,])
\end_layout

\begin_layout Plain Layout

# plotWAC(data.frame(DW$ATTACK[r], DW$AKRDF[r]), xlab='LAMS-based angle of
 attack',
\end_layout

\begin_layout Plain Layout

#         ylab='new fit for radome-based angle of attack', pch=20, type='p',
 xlim=c(-2,5),
\end_layout

\begin_layout Plain Layout

#         ylim=c(-2,5))
\end_layout

\begin_layout Plain Layout

# lines (c(-2,5), c(-2,5), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW[r,],,c(Time,AKRDF, ATTACK)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Sideslip angle
\end_layout

\begin_layout Standard
There were four yaw maneuvers that can be used to find the sensitivity coefficie
nts for the sideslip measurement, as listed in the following table:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
maneuver #
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
flight
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
start
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
end
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
194100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
194330
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
182800
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
183100
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
190130
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
190400
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
201830
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
202130
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
First, for completeness, the conventional fit will be used:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\beta^{*}=-\Psi+\arctan\frac{u_{p}-u}{v_{p}-v}\label{eq:SSREF}
\end{equation}

\end_inset

where 
\begin_inset Formula $\beta^{*}$
\end_inset

 is the reference value for the fit, 
\begin_inset Formula $\Psi$
\end_inset

 is the heading, 
\begin_inset Formula $u_{p}$
\end_inset

 and 
\begin_inset Formula $v_{p}$
\end_inset

 the eastward and northward components of the aircraft ground-speed and
 
\begin_inset Formula $u$
\end_inset

 and 
\begin_inset Formula $v$
\end_inset

 are the east and north components of the wind.
 The empirical relationship for sideslip then can be found by fitting for
 the coefficients {
\begin_inset Formula $s_{0},\,s_{1}$
\end_inset

} in:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\[
\beta^{*}=b_{0}+b_{1}\frac{\mathrm{BDIFR}}{\mathrm{QCXC}}
\]

\end_inset

and then finding the sideslip angle from
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathrm{SSRD}=b_{0}+b_{1}\frac{\mathrm{BDIFR}}{\mathrm{QCXC}}\,\,\,.\label{eq:ssrd}
\end{equation}

\end_inset

Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:sslip-cal}
\end_layout

\end_inset

 shows that the resulting values for 
\begin_inset Formula $\mathrm{SSRD}$
\end_inset

 are in close correspondence to the reference values for the four combined
 yaw maneuvers.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<sslip-cal, include=TRUE, fig.cap='Sideslip angle calculated using new fit
 coefficients (SSRD) as a function of the reference value for sideslip (SSREF).
 The relationship determined by regression is shown as the dashed orange
 line.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

VarList <- c(VarList, 'VEW', 'VNS')
\end_layout

\begin_layout Plain Layout

SaveRData9 <- sprintf ('%s9.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf02_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)), Start=194100,
 End=194330, F=1)
\end_layout

\begin_layout Plain Layout

  DW <- processWind (Data)
\end_layout

\begin_layout Plain Layout

  DW$RF <- rep(1, nrow(DW))
\end_layout

\begin_layout Plain Layout

  DW$BQR <- Data$BDIFR / Data$QCXC
\end_layout

\begin_layout Plain Layout

  Flight <- 'rf04_LAMS'
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  D <- getNetCDF (fname, standardVariables(c(VarList)), F=2)
\end_layout

\begin_layout Plain Layout

  DW2 <- processWind (D)
\end_layout

\begin_layout Plain Layout

  DW2$RF <- rep (2, nrow(DW2))
\end_layout

\begin_layout Plain Layout

  DW2$BQR <- D$BDIFR / D$QCXC
\end_layout

\begin_layout Plain Layout

  Data <- rbind (Data, D[setRange(D, 182800, 183100),])
\end_layout

\begin_layout Plain Layout

  DW <- rbind (DW, DW2[setRange(D, 182800, 183100),])
\end_layout

\begin_layout Plain Layout

  r <- setRange(D, 190130, 190400)
\end_layout

\begin_layout Plain Layout

  D$RF[r] <- 3
\end_layout

\begin_layout Plain Layout

  DW2$RF[r] <- 3
\end_layout

\begin_layout Plain Layout

  Data <- rbind (Data, D[r,])
\end_layout

\begin_layout Plain Layout

  DW <- rbind (DW, DW2[r,])
\end_layout

\begin_layout Plain Layout

  r <- setRange(D, 201830, 202130)
\end_layout

\begin_layout Plain Layout

  D$RF[r] <- 4
\end_layout

\begin_layout Plain Layout

  DW2$RF[r] <- 4
\end_layout

\begin_layout Plain Layout

  DW <- rbind (DW, DW2[r,])
\end_layout

\begin_layout Plain Layout

  Data <- rbind (Data, D[r,])
\end_layout

\begin_layout Plain Layout

  save (Data, DW, file=SaveRData9)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRData9)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

Cradeg <- pi / 180.
\end_layout

\begin_layout Plain Layout

u <- -1.
 * Data$WSC * sin (Data$WDC*Cradeg)
\end_layout

\begin_layout Plain Layout

v <- -1.
 * Data$WSC * cos (Data$WDC*Cradeg)
\end_layout

\begin_layout Plain Layout

Data$SSREF <- -Data$THDG + atan2((Data$GGVEW-u), (Data$GGVNS-v))/ Cradeg
\end_layout

\begin_layout Plain Layout

Data$SSREF[Data$SSREF < -180.] <- Data$SSREF[Data$SSREF < -180.] + 360.
\end_layout

\begin_layout Plain Layout

#plot (DataV$SSREF, DataV$SSLIP, pch=16, cex=0.6,col='blue')
\end_layout

\begin_layout Plain Layout

Data$BQR <- Data$BDIFR / Data$QCXC
\end_layout

\begin_layout Plain Layout

sfm <- lm(SSREF~BQR, data=Data)
\end_layout

\begin_layout Plain Layout

cfs <- coefficients(sfm)
\end_layout

\begin_layout Plain Layout

# print (sprintf('fit coefficients %.4f %.4f', cfs[1], cfs[2])) 
\end_layout

\begin_layout Plain Layout

Data$S2 <- cfs[1] + cfs[2] * Data$BQR
\end_layout

\begin_layout Plain Layout

with(Data, plotWAC(data.frame(SSREF, S2), xlab='SSREF', ylab='SSRD', pch=20,
 type='p'))
\end_layout

\begin_layout Plain Layout

lines (c(-6,6), c(-6,6), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

DWfit <- DW[DW$RF == 1,]
\end_layout

\begin_layout Plain Layout

DWfit <- DWfit[setRange (DWfit, 194150, 194305),]
\end_layout

\begin_layout Plain Layout

DWfit <- rbind (DWfit, DW[DW$RF == 4,])
\end_layout

\begin_layout Plain Layout

fls <- lm (DWfit$SSLIP ~ DWfit$BQR)
\end_layout

\begin_layout Plain Layout

cfls <- coef(fls)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset

 
\end_layout

\begin_layout Standard
The resulting sensitivity coefficients for sideslip are {
\begin_inset Formula $b_{0},\,b{}_{1}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfs[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfs[2], 4)}
\end_layout

\end_inset

}.
 The fit was very good, with a residual standard deviation of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(summary(sfm)$sigma, 2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

.
 For comparison, the standard values in the Technical Note on Processing
 Algorithms are {0, 12.2115}.
 As discussed in the Technical Note on Wind Uncertainty, it is difficult
 to separate an offset in sideslip from an offset in heading, so the difference
 in the first coefficient may instead apply to heading.
\begin_inset Foot
status open

\begin_layout Plain Layout
An offset of -0.1
\begin_inset Formula $^{\circ}$
\end_inset

 applied to heading in the original processing has not been removed here.
\end_layout

\end_inset

 The difference in offsets for these two calibrations is large, although
 the slope coefficients are in reasonable agreement.
 
\end_layout

\begin_layout Standard
The LAMS measurement of sideslip provides an alternate means of determining
 the slope parameter.
\begin_inset Foot
status open

\begin_layout Plain Layout
The appropriate offsets in sideslip and heading will still need to be found
 from analysis of circle maneuvers.
\end_layout

\end_inset

 The reference value 
\begin_inset Formula $\beta^{*}$
\end_inset

 for the fit can be determined from the LAMS-based measurements of the relative
 wind, as discussed in the introductory section:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\beta^{*}=\arctan\left(\frac{\mathrm{RW}_{y}}{\mathrm{RW}_{x}}\right)\label{eq:ssref-LAMS}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The LAMS-based measurements of sideslip bear little similarity to those
 from the radome for sideslip maneuvers #2 and #3, so there are evidently
 measurement problems that make those unreliable.
 Maneuver #4 is good, and maneuver #1 appears valid for the period 194130–194305
, so those measurements were used for the fit.
 The LAMS-based fit gave coefficients {
\begin_inset Formula $b_{0},\,b_{1}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfls[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfls[2], 4)}
\end_layout

\end_inset

}, with a residual standard deviation about the fit of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(summary(fls)$sigma, 2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

.
 These values are close to those determined in the standard way, so this
 calibration provides support for the conventional approach, although the
 difference in slope is significant (with estimated standard uncertainty
 in 
\begin_inset Formula $b_{1}$
\end_inset

 of 0.05
\begin_inset Formula $^{\circ}$
\end_inset

).
 The value for 
\begin_inset Formula $b_{1}$
\end_inset

 determined from the LAMS-based measurements, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfls[2], 3)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

, appears to be the best available, but the value of 
\begin_inset Formula $b_{0}$
\end_inset

 still needs to be determined from the circle maneuvers that can separate
 an offset in sideslip from an offset in heading.
\end_layout

\begin_layout Section
Calibration of the pressure defect
\end_layout

\begin_layout Subsection
Previous LAMS-based calibration
\end_layout

\begin_layout Standard
A previous calibration of the C-130 pressure defect was published in Cooper
 et al., 2014.
 The key to this calibration is that LAMS provides a measurement of airspeed,
 from which the dynamic pressure can be calculated if the temperature and
 pressure are known.
 The result is relatively insensitive to temperature and pressure, so this
 is an accurate result despite the need to know the airspeed to calculate
 the temperature and the need to know the static defect to calculate the
 pressure.
 Because a pitot tube is thought to provide a valid measurement of the total
 pressure, subtracting the dynamic pressure from the total pressure gives
 the true ambient pressure.
 The difference between this value and the measured pressure is then the
 static defect.
 Furthermore, because the measured dynamic pressure is based on a measurement
 of the difference between the total and static pressures, the same correction
 represented by the static defect applies with reversed sign to the measured
 dynamic pressure.
\end_layout

\begin_layout Standard
The equation published there, Eq.
\begin_inset space ~
\end_inset

11, was subsequently revised to avoid circularity in data processing by
 basing the empirical relationship on uncorrected quantities, as discussed
 in the Technical Note on Processing Algorithms [version as of June 2016].
 For the C-130, the error in the measurement of ambient or static pressure
 (
\begin_inset Formula $\Delta p$
\end_inset

) was found to be given by the following empirical representation, to an
 uncertainty of less than 0.3
\begin_inset space ~
\end_inset

hPa:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\Delta p}{p}=a_{0}+a_{1}\frac{\alpha}{a_{r}}+a_{2}M\label{eq:PCOR}
\end{equation}

\end_inset

where 
\begin_inset Formula $p$
\end_inset

 is the uncorrected measurement of pressure (PSFD or PSFRD), 
\begin_inset Formula $\alpha$
\end_inset

 is the angle of attack (AKRD), calculated from uncorrected measurements
 as described in the Algorithms document, 
\begin_inset Formula $a_{r}$
\end_inset

 is a constant with value 1
\begin_inset Formula $^{\circ}$
\end_inset

 (included only to keep the equation dimensionless), and 
\begin_inset Formula $M$
\end_inset

 is the Mach number calculated from uncorrected measurements of static and
 dynamic pressure.
 The coefficients are {
\begin_inset Formula $a_{0},\,a_{1},\,a_{2}$
\end_inset

} = {
\begin_inset Formula $-$
\end_inset

0.00637, 0.001366, 0.0149} for PSFD and {
\begin_inset Formula $-$
\end_inset

0.00754, 0.000497, 0.0368} for the alternate pressure measurement PSFRD.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<PSA-FRAPPE, include=TRUE, fig.cap='The difference between the avionic-provided
 pressure (PS
\backslash

\backslash
_A) and the standard pressure after the correction as expressed in (1) (PSFDC).',
 cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRDataA <- sprintf ('%sA.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  fname <- sprintf ('%sFRAPPE/FRAPPErf05.nc', Directory)
\end_layout

\begin_layout Plain Layout

  VList <- c('PS_A', 'PS_A2', 'PSFC', 'PSFDC', 'PSFD', 'PSFRD', 'QCF', 'AKRD',
 'ROLL')
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables (VList))
\end_layout

\begin_layout Plain Layout

  Data$PSC <- Data$PSFD + PCorFunction (Data$PSFD, Data$QCF, Data$AKRD,
 "C130")
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataA)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataA)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

Data <- Data[Data$TASX > 60 & abs(Data$ROLL) < 5,]
\end_layout

\begin_layout Plain Layout

with (Data, hist (PS_A-PSFDC, breaks=300, xlim=c(1,4)))
\end_layout

\begin_layout Plain Layout

dPA <- with (Data, mean (PS_A-PSFDC, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

dPC <- mean (Data$PSC - Data$PSFDC, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

# with (Data, plotWAC (data.frame (PS_A, PSFDC), xlab='PS_A', ylab='PSFDC',
 pch=20, type='p'))
\end_layout

\begin_layout Plain Layout

# lines(c(500,900), c(500,900), col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<TAS-comparison, include=FALSE, fig.cap='The conventional measurement of
 airspeed (TASX) plotted vs.
\backslash

\backslash
 the LAMS-derived measurement of airspeed (TASL), for speed run 
\backslash

\backslash
#7.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

with (DSR, plotWAC(data.frame(TASL, TASX), xlab='LAMS TAS', ylab='TASX',
 pch=20, type='p'))
\end_layout

\begin_layout Plain Layout

# with (DSR, hist (TASX-TASL, breaks=100, xlim=c(-2,2)))
\end_layout

\begin_layout Plain Layout

DTAS <-with(DSR, mean (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

SDTAS <- with(DSR, sd (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
These coefficients were based on measurements collected during the IDEAS
 project of November 2011.
 However, this original parameterization did not lead to consistent differences
 when compared to the avionics-system pressure PS_A in subsequent projects.
 A representative example from the FRAPPE measurements is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:PSA-FRAPPE}
\end_layout

\end_inset

.
 The mean offset between the avionics-supplied pressure and the research
 pressure is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(dPA, 1)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa, a value that is similar to the differences measured in other projects
 including NOMADSS, WINTER, and ARISTO-2015.
 However, this difference is significantly different from the 
\begin_inset Formula $-1.08$
\end_inset


\begin_inset space ~
\end_inset

hPa offset found in the original IDEAS-4 study.
 Because it is expected that PS_A has remained consistent, it appears that
 the pressure correction that is being applied is not consistent with the
 original calibration.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Further evidence is provided by a comparison of airspeed as measured by
 the LAMS and the conventional system employing the above PCOR function,
 as shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:TAS-comparison}
\end_layout

\end_inset

.
 The mean difference between the LAMS-measured airspeed and the standard
 airspeed was 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(DTAS, 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

m/s and the standard deviation for 1-Hz measurements was 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(SDTAS, 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

m/s.
 Because the LAMS-derived airspeed is smaller, even this small difference
 might arise from some airflow distortion at the displaced positions of
 the LAMS beams.
 There is some additional evidence for this in the next section.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Reason for repeating the calibration
\end_layout

\begin_layout Standard
A weakness in the available calibration, present also in ARISTO-2015, is
 that measurements at altitudes between sea level and about 850
\begin_inset space ~
\end_inset

hPa have not been available.
 Problems may arise with use of the PCOR function as expressed in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:PCOR"

\end_inset

) to such low-level flight, so the following paragraphs will revisit the
 determination of the empirical relationship for the static defect using
 low-level measurements from ARISTO-2016 flight 6.
 
\end_layout

\begin_layout Standard
As discussed in Cooper et al., 2014, the key to the LAMS-based calibration
 of dynamic pressure is to find the airspeed 
\begin_inset Formula $v$
\end_inset

, from which the dynamic pressure 
\begin_inset Formula $q$
\end_inset

 is found from 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
q=p\left\{ \left(\frac{v^{2}}{2c_{p}T}+1\right)^{c_{p}/R_{a}}-1\right\} \equiv p\chi(v,T)\label{eq:dynamic-pressure}
\end{equation}

\end_inset

where 
\begin_inset Formula $p$
\end_inset

 is the ambient pressure, 
\begin_inset Formula $c_{p}$
\end_inset

 the specific heat of air at constant pressure, 
\begin_inset Formula $T$
\end_inset

 the absolute temperature, and 
\begin_inset Formula $R_{a}$
\end_inset

 the gas constant for air, and 
\begin_inset Formula $\chi(v,T)$
\end_inset

 is defined by (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:dynamic-pressure"

\end_inset

) to simplify terminology.
 Although the corrections for humidity are small, humidity-dependent value
 for 
\begin_inset Formula $c_{p}$
\end_inset

 and 
\begin_inset Formula $R_{a}$
\end_inset

 will be used in this equation.
\end_layout

\begin_layout Standard
The error arising from the static defect 
\begin_inset Formula $\Delta p$
\end_inset

 that applies to the measured pressure 
\begin_inset Formula $p_{m}$
\end_inset

 should be included when (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:dynamic-pressure"

\end_inset

) is used (
\begin_inset Formula $p=p_{M}-\Delta p$
\end_inset

), although this normally makes little difference because the fractional
 error in 
\begin_inset Formula $p$
\end_inset

 is small.
 It was argued in Cooper et al.
 (2014) that the error in dynamic pressure 
\begin_inset Formula $\Delta q$
\end_inset

 is the negative of the error in ambient pressure 
\begin_inset Formula $\Delta p$
\end_inset

.
 Then the errors in dynamic pressure and ambient pressure are given by
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\Delta q=q_{m}-p\chi(v,T)\label{eq:delta-q}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\Delta p=-\Delta q=\frac{-q_{m}+p_{m}\chi(v,T)}{1+\chi(v,T)}\label{eq:delta-p}
\end{equation}

\end_inset

where 
\begin_inset Formula $q_{m}$
\end_inset

 is the measured dynamic pressure.
 Because LAMS provides an independent and low-uncertainty measurement of
 the airspeed 
\begin_inset Formula $v$
\end_inset

, it is possible to determine the errors in both 
\begin_inset Formula $q_{m}$
\end_inset

 and 
\begin_inset Formula $p_{m}$
\end_inset

.
\end_layout

\begin_layout Standard
The procedure used in Cooper et al.\SpecialChar softhyphen
(2014) and in the RAF Technical Note on
 Processing Algorithms was to determine parametric fits to the errors in
 terms of quantities like Mach number, angle of attack and sideslip angle.
 Such a parameterized fit can then be used to correct the measurements when
 LAMS is not present or not functioning.
 The approach described in the Processing Algorithms Technical Note led
 to the parameterization represented by (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:PCOR"

\end_inset

) above, However, here data spanning a larger range of flight conditions
 will be used.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<aoa-rf6-2016, include=TRUE, fig.cap=' ', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

PCA <- FALSE   # use SG processing
\end_layout

\begin_layout Plain Layout

VarList2 <- c('PSFD', 'QCF', 'ATX', 'EWX', 'AKRD', 'SSRD', 'PSFRD', 'QCFR',
 'ROLL', 'PITCH', 'THDG',
\end_layout

\begin_layout Plain Layout

             'CPITCH_LAMS', 'CROLL_LAMS', 'CTHDG_LAMS', 'CVEW_LAMS', 'CVNS_LAMS'
, 'CVSPD_LAMS',
\end_layout

\begin_layout Plain Layout

             'GGVEW', 'GGVNS', 'GGVSPD', 'ADIFR', 'PSXC', 'QCXC', 'GGALT',
 'BDIFR',
\end_layout

\begin_layout Plain Layout

             'BEAM1speed', 'BEAM2speed', 'BEAM3speed', 'BEAM4speed', 'TASX',
 'GGVSPD', 'CONCD_RWT',
\end_layout

\begin_layout Plain Layout

             'PS_A', 'PS_A2', 'QC_A', 'QC_A2', 'WIC', 'VEW', 'VNS')
\end_layout

\begin_layout Plain Layout

SaveRDataB <- sprintf ('%sB.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Directory <- 'ARISTO'
\end_layout

\begin_layout Plain Layout

  Project <- 'ARISTO2016'
\end_layout

\begin_layout Plain Layout

  Flight <- 'rf06LAMS'
\end_layout

\begin_layout Plain Layout

  fname <- sprintf ('%s%s/%s%s.nc', DataDirectory(), Directory, Project,
 Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, VarList2)
\end_layout

\begin_layout Plain Layout

  Data <- Data[setRange (Data, 190400, 264118),]  # use subset of the flight
 after landing/TO
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataB)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataB)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

Data$AOAREF <- Data$PITCH - (Data$GGVSPD / Data$TASX) * (180 / pi)
\end_layout

\begin_layout Plain Layout

Data$QR <- Data$ADIFR / Data$QCF
\end_layout

\begin_layout Plain Layout

Data$Mach <- MachNumber (Data$PSFD, Data$QCF, Data$EWX)
\end_layout

\begin_layout Plain Layout

Data$Valid <- Data$TASX > 60 & abs(Data$ROLL) < 5 & Data$PITCH < 20 & Data$CONCD
_RWT < 10
\end_layout

\begin_layout Plain Layout

Data$Valid[is.na(Data$Valid)] <- FALSE
\end_layout

\begin_layout Plain Layout

DF <- Data[Data$Valid, ]
\end_layout

\begin_layout Plain Layout

f <- lm (AOAREF~QR+I(QR*Mach), data=DF)
\end_layout

\begin_layout Plain Layout

cf <- coefficients(f)
\end_layout

\begin_layout Plain Layout

Data$AKRD <- cf[1] + Data$QR * (cf[2] + cf[3] * Data$Mach)  # replace AKRD
 with new fit
\end_layout

\begin_layout Plain Layout

DW <- processWind (Data)  # get LAMS-based TAS, ATTACK, SSLIP, TASCSQ
\end_layout

\begin_layout Plain Layout

DW$Valid <- Data$Valid
\end_layout

\begin_layout Plain Layout

## now correct DW$ATTACK to match AKRD, assuming offset with linear-in-time
 change
\end_layout

\begin_layout Plain Layout

## NOTE that ATTACK then needs to be used with PITCH, not CPITCH_LAMS, to
 calc W
\end_layout

\begin_layout Plain Layout

DW$TE <- Data$TE <- as.vector (DW$Time-DW$Time[1])
\end_layout

\begin_layout Plain Layout

cff <- with (DW[DW$TASCSQ < 0.1 & DW$Valid,], coef(lm((AKRD-ATTACK) ~ (TE))))
\end_layout

\begin_layout Plain Layout

# cff <- with (Data[Valid,], coef(lm((PITCH-CPITCH_LAMS) ~ (TE)))) # didn't
 work as well
\end_layout

\begin_layout Plain Layout

DW$DA <- cff[1]+cff[2]*DW$TE
\end_layout

\begin_layout Plain Layout

DW$ATTACK <- DW$ATTACK + DW$DA
\end_layout

\begin_layout Plain Layout

# with (DW[DW$TASCSQ < 0.1 & DW$Valid,], plot(data.frame(PSFD, AKRD-ATTACK),
 type='p', pch=20, col='blue', ylim=c(-2,2)))
\end_layout

\begin_layout Plain Layout

# abline(h=0, col='red')
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX  ## processWind returns LAMS-based TAS in TASX
\end_layout

\begin_layout Plain Layout

## transfer some other variables for convenience
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

DW$QR <- Data$QR
\end_layout

\begin_layout Plain Layout

DW$Mach <- Data$Mach
\end_layout

\begin_layout Plain Layout

DW$AOAREF <- Data$AOAREF
\end_layout

\begin_layout Plain Layout

DW$PITCH <- Data$PITCH  # needed if W recalculated
\end_layout

\begin_layout Plain Layout

DW$ROLL <- Data$ROLL
\end_layout

\begin_layout Plain Layout

DW$THDG <- Data$THDG
\end_layout

\begin_layout Plain Layout

DW$WIL <- DW$WIN    ## this is the LAMS-only value
\end_layout

\begin_layout Plain Layout

DW$WIC <- Data$WIC
\end_layout

\begin_layout Plain Layout

DF <- DW     ## use a restricted data.frame to fit to LAMS-based ATTACK
\end_layout

\begin_layout Plain Layout

DF$ATTACK[DF$TASCSQ > 0.1] <- NA  ## only use good 4-beam measurements from
 LAMS
\end_layout

\begin_layout Plain Layout

DF$AKRD[DF$TASCSQ > 0.1] <- NA  
\end_layout

\begin_layout Plain Layout

## eliminate some additional ATTACK measurements that are obviously bad
 in this flight:
\end_layout

\begin_layout Plain Layout

dt <- DF$ATTACK - DF$AKRD
\end_layout

\begin_layout Plain Layout

dt <- dt - mean (dt, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DF$ATTACK[abs(dt) > 0.8] <- NA
\end_layout

\begin_layout Plain Layout

DF$AKRD[abs(dt) > 0.8] <- NA
\end_layout

\begin_layout Plain Layout

DF <- DF[DF$Valid, ]
\end_layout

\begin_layout Plain Layout

fl <- lm (ATTACK ~ QR + I(QR*Mach), data=DF)
\end_layout

\begin_layout Plain Layout

cfl <- coef (fl)
\end_layout

\begin_layout Plain Layout

Data$AKRDL <- cfl[1] + Data$QR * (cfl[2] + cfl[3] * Data$Mach) 
\end_layout

\begin_layout Plain Layout

DW$AKRDL <- cfl[1] + DW$QR * (cfl[2] + cfl[3] * DW$Mach)
\end_layout

\begin_layout Plain Layout

sdl <- with(DW[DW$TASCSQ < 0.1 & DW$Valid, ], sd(AKRDL-ATTACK, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

# with(DW, hist(AKRDL-ATTACK, breaks=200))
\end_layout

\begin_layout Plain Layout

## replace AKRD with the new LAMS-based angle of attack for subsequent processin
g
\end_layout

\begin_layout Plain Layout

# Data$AKRD <- Data$AKRDL
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Revised angle of attack
\begin_inset CommandInset label
LatexCommand label
name "subsec:aoa-r6-2016"

\end_inset


\end_layout

\begin_layout Standard
Because angle of attack (
\begin_inset Formula $\alpha$
\end_inset

) is an important contributor to the parameterized representation (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:PCOR"

\end_inset

), and because there have been some problems representing angle of attack
 over the full operating range of the C-130 including near sea level, it
 is useful to determine the angle-of-attack relationship again using flight
 6 of ARISTO-2016, which included flight segments at low level.
 The evidence in the previous section on angle-of-attack coefficients indicated
 that there were flight-to-flight variations in sensitivity coefficients
 for ARISTO-2015 flights, so only this one flight will be used here, and
 the LAMS-provided angle of attack will be used as a calibration reference
 for determing the sensitivity coefficients.
 The same procedures were followed as in that earlier section, with the
 result that the sensitivity coefficients determined from the LAMS-based
 reference value were {
\begin_inset Formula $c_{0},\,c_{1},\,c_{2}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[2], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[3], 4)}
\end_layout

\end_inset

}.
 These coefficients represented the LAMS-based measurements of angle of
 attack with standard deviation 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(sdl, 2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

 and, because the LAMS mean angle of attack differs from that relative to
 the fuselage, these coefficients have been adjusted to match the mean angle
 of attack provided by the conventional radome-based measurement and calibration.
 This LAMS-based angle of attack was then used for the following processing.
 Because there was unexplained variation in the characteristics of the radome-ba
sed measurement from flight to flight in ARISTO-2015, it may be necessary
 to develop a new calibration for each project or even each flight, but
 once that calibration of the radome is determined then the pressure corrections
 developed below should apply to new projects.
\end_layout

\begin_layout Standard
Candidate variables for the parameterization include the measured dynamic
 pressure, measured ambient pressure, angle of attack, sideslip angle, Mach
 number (a function of dynamic and ambient pressure with minor dependence
 on humidity), so for the purpose of determining this parameterization a
 special R data.frame was constructed that contained these variables along
 with the LAMS-determined airspeed and the temperature and water vapor pressure
 for all cases where this could be determined reliably.
 With four-beam LAMS the measured airspeed is over-constrained so the chisquare
 for the airspeed measurement provides an indication of the quality of that
 measurement and can be used to identify suspect measurements.
 The formula used is listed later in this report, as (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chi-2"

\end_inset

), and as defined there (with arbitrary specification of the expected standard
 deviation as 1
\begin_inset space ~
\end_inset

m/s) a limiting value of 
\begin_inset Formula $\chi^{2}<0.1$
\end_inset


\begin_inset space \thinspace{}
\end_inset

m
\begin_inset Formula $^{2}$
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

 appears to be a reasonable choice for excluding measurements.
 This test was therefore applied when compiling the data.frame, and it was
 also required that valid measurements (as determined by the Python processing
 program) be available for all four beams.
 The residual scatter for the fits was improved if the measured dynamic
 pressure 
\begin_inset Formula $q_{m}$
\end_inset

 was shifted earlier in time by about 105
\begin_inset space ~
\end_inset

ms, which is reasonable because the LAMS observes ahead of the aircraft
 so a time shift of about this magnitude between LAMS line-of-sight airspeeds
 and 
\begin_inset Formula $q_{m}$
\end_inset

 is expected.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<save-this, eval=FALSE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

processWind <- function(Data) {
\end_layout

\begin_layout Plain Layout

  Data$BEAM1speed <- zoo::na.approx (as.vector(Data$BEAM1speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM2speed <- zoo::na.approx (as.vector(Data$BEAM2speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM3speed <- zoo::na.approx (as.vector(Data$BEAM3speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  Data$BEAM4speed <- zoo::na.approx (as.vector(Data$BEAM4speed), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  ## replace with Scott's values
\end_layout

\begin_layout Plain Layout

  if (PCA) {
\end_layout

\begin_layout Plain Layout

    Data$BEAM1speed <- zoo::na.approx (as.vector(Data$Beam1_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM2speed <- zoo::na.approx (as.vector(Data$Beam2_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM3speed <- zoo::na.approx (as.vector(Data$Beam3_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    Data$BEAM4speed <- zoo::na.approx (as.vector(Data$Beam4_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  ## try to fix CTHDG_LAMS bad points in transition through 180: (may no
 longer be needed)
\end_layout

\begin_layout Plain Layout

  for (i in 2:(nrow(Data)-1)) {
\end_layout

\begin_layout Plain Layout

    if (is.na(Data$CTHDG_LAMS[i]) || is.na(Data$CTHDG_LAMS[i-1]) || is.na(Data$CTHD
G_LAMS[i+1])) {next}
\end_layout

\begin_layout Plain Layout

    if (abs(Data$CTHDG[i-1]-Data$CTHDG_LAMS[i+1]) > 10.) {next}
\end_layout

\begin_layout Plain Layout

    if ((Data$CTHDG_LAMS[i-1] < 180.) && (Data$CTHDG_LAMS[i+1] > 180)) {Data$CTHD
G_LAMS[i] <- NA}
\end_layout

\begin_layout Plain Layout

    if ((Data$CTHDG_LAMS[i-1] > 180.) && (Data$CTHDG_LAMS[i+1] < 180)) {Data$CTHD
G_LAMS[i] <- NA}
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  Data$CTHDG_LAMS <- zoo::na.approx (as.vector(Data$CTHDG_LAMS), maxgap=1000,
 na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  Theta =  c(35.0802, 34.8501, 34.8496, 0.) * pi / 180 # revised 12 May 2014
\end_layout

\begin_layout Plain Layout

  Theta <- c(35, 0, 35, 35) * pi / 180  ## ARISTO
\end_layout

\begin_layout Plain Layout

  Phi = c(179.2171, -61.0712, 59.1506, 0.) * pi / 180  #  "  "
\end_layout

\begin_layout Plain Layout

  Phi = c(0, 0, -120, 120) * pi / 180
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  # also need the distances from the IRS to LAMS: (x,y,z)
\end_layout

\begin_layout Plain Layout

  LL = c(-10.305, -6.319, 1.359)                # these are GV values; need
 C130 values
\end_layout

\begin_layout Plain Layout

  # unit vectors along beams are then:
\end_layout

\begin_layout Plain Layout

  #   a[i] = [cos(Theta[i]), -sin(Theta[i])*sin(Phi[i]), sin(Theta[i])*cos(Phi[i
])]
\end_layout

\begin_layout Plain Layout

  # and the dot products with the (i,j,k) unit vectors give the direction
 cosine matrix:
\end_layout

\begin_layout Plain Layout

  S = c(cos(Theta[1]), -sin(Theta[1])*sin(Phi[1]), sin(Theta[1])*cos(Phi[1]),
 
\end_layout

\begin_layout Plain Layout

        cos(Theta[2]), -sin(Theta[2])*sin(Phi[2]), sin(Theta[2])*cos(Phi[2]),
 
\end_layout

\begin_layout Plain Layout

        cos(Theta[3]), -sin(Theta[3])*sin(Phi[3]), sin(Theta[3])*cos(Phi[3]))
\end_layout

\begin_layout Plain Layout

  S4 <- c(S, cos(Theta[4]), -sin(Theta[4])*sin(Phi[4]), sin(Theta[4])*cos(Phi[4]
))
\end_layout

\begin_layout Plain Layout

  dim(S) <- c(3,3)
\end_layout

\begin_layout Plain Layout

  Si = t(solve(S))  # calculate the inverse of S -- this is the 3-beam version
\end_layout

\begin_layout Plain Layout

  ## the following commented lines are the python code:
\end_layout

\begin_layout Plain Layout

  # S4 = np.vstack ((S, [cos(Theta[3]), -sin(Theta[3])*sin(Phi[3]), sin(Theta[3])
*cos(Phi[3])]))
\end_layout

\begin_layout Plain Layout

  # StS =  linalg.inv (ma.dot (S4.T, S4))
\end_layout

\begin_layout Plain Layout

  # M = ma.dot (StS, S4.T)      # matrix for finding relative wind from 4-beam
 LAMS
\end_layout

\begin_layout Plain Layout

  dim(S4) <- c(3,4)
\end_layout

\begin_layout Plain Layout

  StS <- S4 %*% t(S4)
\end_layout

\begin_layout Plain Layout

  StS <- solve(StS)
\end_layout

\begin_layout Plain Layout

  M <- StS %*% S4
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  A = c(Data$BEAM1speed, Data$BEAM2speed, Data$BEAM3speed)
\end_layout

\begin_layout Plain Layout

  A4 <- c(A, Data$BEAM4speed)
\end_layout

\begin_layout Plain Layout

  dim(A4) <- c(nrow(Data), 4)
\end_layout

\begin_layout Plain Layout

  dim(A) <- c(nrow(Data), 3)
\end_layout

\begin_layout Plain Layout

  RW = t (Si %*% t(A))    # gives u, v, w components, RW[,1] is u
\end_layout

\begin_layout Plain Layout

  RW2 <- t (M %*% t(A4))
\end_layout

\begin_layout Plain Layout

  ## calculate the error in the solution:
\end_layout

\begin_layout Plain Layout

  A4P <- t (t (S4) %*% t (RW2)) - A4
\end_layout

\begin_layout Plain Layout

  CSQ <- A4P[,1]^2 + A4P[,2]^2 + A4P[,3]^2 + A4P[,4]^2
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  ## set up special data.frame for calculation of wind:
\end_layout

\begin_layout Plain Layout

  D <- data.frame("Time"=Data$Time)
\end_layout

\begin_layout Plain Layout

  D$TASX <- sqrt(RW2[,1]^2 + RW2[,2]^2 + RW2[,3]^2)
\end_layout

\begin_layout Plain Layout

  D$TASX3 <- sqrt(RW[,1]^2 + RW[,2]^2 + RW[,3]^2)
\end_layout

\begin_layout Plain Layout

  D$TASCSQ <- CSQ 
\end_layout

\begin_layout Plain Layout

  D$ATTACK <- atan (RW2[, 3] / RW2[, 1]) * 180 / pi
\end_layout

\begin_layout Plain Layout

  D$SSLIP <-  atan (RW2[, 2] / RW2[, 1]) * 180 / pi
\end_layout

\begin_layout Plain Layout

  D$GGVEW <- Data$CVEW_LAMS
\end_layout

\begin_layout Plain Layout

  D$GGVNS <- Data$CVNS_LAMS
\end_layout

\begin_layout Plain Layout

  D$GGVSPD <- Data$CVSPD_LAMS
\end_layout

\begin_layout Plain Layout

  D$VEW <- Data$CVEW_LAMS
\end_layout

\begin_layout Plain Layout

  D$VNS <- Data$CVNS_LAMS
\end_layout

\begin_layout Plain Layout

  D$THDG <- Data$CTHDG_LAMS
\end_layout

\begin_layout Plain Layout

  D$ROLL <- Data$CROLL_LAMS
\end_layout

\begin_layout Plain Layout

  D$PITCH <- Data$CPITCH_LAMS
\end_layout

\begin_layout Plain Layout

  ## save some variables for ease of plotting:
\end_layout

\begin_layout Plain Layout

  D$BEAM1speed <- Data$BEAM1speed
\end_layout

\begin_layout Plain Layout

  D$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

  D$BEAM3speed <- Data$BEAM3speed
\end_layout

\begin_layout Plain Layout

  D$BEAM4speed <- Data$BEAM4speed
\end_layout

\begin_layout Plain Layout

  D$WDC <- Data$WDC
\end_layout

\begin_layout Plain Layout

  D$WSC <- Data$WSC
\end_layout

\begin_layout Plain Layout

  D$WIC <- Data$WIC
\end_layout

\begin_layout Plain Layout

  D$WD_LAMS <- Data$WD_LAMS
\end_layout

\begin_layout Plain Layout

  D$WS_LAMS <- Data$WS_LAMS
\end_layout

\begin_layout Plain Layout

  D$WI_LAMS <- Data$WI_LAMS
\end_layout

\begin_layout Plain Layout

  D$AKRD <- Data$AKRD
\end_layout

\begin_layout Plain Layout

  D$SSRD <- Data$SSRD
\end_layout

\begin_layout Plain Layout

  D$ADIFR <- Data$ADIFR
\end_layout

\begin_layout Plain Layout

  D$QCF <- Data$QCF
\end_layout

\begin_layout Plain Layout

  D$GGVSPD <- Data$GGVSPD
\end_layout

\begin_layout Plain Layout

  D$PSFD <- Data$PSFD
\end_layout

\begin_layout Plain Layout

  D$EWX <- Data$EWX
\end_layout

\begin_layout Plain Layout

  # if (grepl('rf03', fname)) {
\end_layout

\begin_layout Plain Layout

  #   rg <- setRange (D$Time, 192300,213000)
\end_layout

\begin_layout Plain Layout

  #   D <- D[rg, ]
\end_layout

\begin_layout Plain Layout

  # }
\end_layout

\begin_layout Plain Layout

  ## use standard wind processor 
\end_layout

\begin_layout Plain Layout

  ### rotation-rate corrections should be removed first, 
\end_layout

\begin_layout Plain Layout

  ### but for standard routine they are insignificant so will be ignored.
\end_layout

\begin_layout Plain Layout

  DW <- WindProcessor (data=D)
\end_layout

\begin_layout Plain Layout

  return (DW)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

<<construct-dataframe, include=FALSE, cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Data$QCF <- ShiftInTime (Data$QCF, 1, -105)
\end_layout

\begin_layout Plain Layout

# Data$QCF <- SmoothInterp (Data$QCF, .Length=7)
\end_layout

\begin_layout Plain Layout

# DW <- processWind (Data)  ## this causes problems; leave commented
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$PSFD <- Data$PSFD
\end_layout

\begin_layout Plain Layout

DW$PSFRD <- Data$PSFRD
\end_layout

\begin_layout Plain Layout

DW$QCFR <- Data$QCFR
\end_layout

\begin_layout Plain Layout

DW$PS_A <- Data$PS_A
\end_layout

\begin_layout Plain Layout

DW$PS_A2 <- Data$PS_A2
\end_layout

\begin_layout Plain Layout

DW$QC_A <- Data$QC_A
\end_layout

\begin_layout Plain Layout

DW$QC_A2 <- Data$QC_A2
\end_layout

\begin_layout Plain Layout

DW$CONCD_RWT <- Data$CONCD_RWT
\end_layout

\begin_layout Plain Layout

DW$GGALT <- Data$GGALT
\end_layout

\begin_layout Plain Layout

DW$QCF <- Data$QCF
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

Valid <- DW$TASCSQ < 0.1
\end_layout

\begin_layout Plain Layout

Valid <- Valid & DW$TASX > 60 & abs(DW$ROLL) < 5 & !is.na(DW$PITCH) & DW$PITCH
 < 20
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

DW <- DW[Valid,]
\end_layout

\begin_layout Plain Layout

NV <- nrow(DW)
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSFD)
\end_layout

\begin_layout Plain Layout

TK <- 273.15+DW$ATX
\end_layout

\begin_layout Plain Layout

Chi <- ( (1+DW$TASL^2 / (2*CP[,1]*TK))^(CP[,1]/CP[,3]) - 1)
\end_layout

\begin_layout Plain Layout

DW$DQ <- (DW$QCF - DW$PSFD * Chi) / (1 + Chi)
\end_layout

\begin_layout Plain Layout

DW$DQ2 <- (DW$QCFR - DW$PSFRD * Chi) / (1 + Chi)
\end_layout

\begin_layout Plain Layout

DW$DP <- -DW$DQ
\end_layout

\begin_layout Plain Layout

DW$DP2 <- -DW$DQ2
\end_layout

\begin_layout Plain Layout

## now have the errors DQ and DP, which are the negatives of the corrections,
 for Q and P
\end_layout

\begin_layout Plain Layout

## want to find a representation of those correction factors
\end_layout

\begin_layout Plain Layout

DW$QP <- DW$QCF / DW$PSFD
\end_layout

\begin_layout Plain Layout

DW$QP2 <- DW$QCFR / DW$PSFRD
\end_layout

\begin_layout Plain Layout

DW$M <- MachNumber (DW$PSFD, DW$QCF, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$M2 <- MachNumber (DW$PSFRD, DW$QCFR, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$DQP <- DW$DQ / DW$PSFD
\end_layout

\begin_layout Plain Layout

DW$DQP2 <- DW$DQ2 / DW$PSFRD
\end_layout

\begin_layout Plain Layout

summary(lm(DQ ~ AKRD, data=DW))
\end_layout

\begin_layout Plain Layout

summary(lm(DQP ~ I(AKRD*QP)+QP+M+I(AKRD*QP*M), data=DW))
\end_layout

\begin_layout Plain Layout

summary(lm(DQP ~ AKRD*M*QP*I(AKRD^2)*I(QP^2)*I(M^2), data=DW))
\end_layout

\begin_layout Plain Layout

fq23 <- lm(DQP ~ AKRD+M+QP+I(QP^2)+AKRD:M+M:QP+QP:I(AKRD^2)+M:I(QP^2)+QP:I(QP^2)
\end_layout

\begin_layout Plain Layout

           +I(AKRD^2):I(QP^2)+AKRD:I(M^2)+M:I(M^2)+QP:I(M^2)+I(QP^2):I(M^2)+M:QP
:I(AKRD^2)
\end_layout

\begin_layout Plain Layout

           +AKRD:M:I(QP^2)+AKRD:QP:I(QP^2)+M:I(AKRD^2):I(QP^2)+AKRD:M:I(M^2)
\end_layout

\begin_layout Plain Layout

           +I(AKRD^2):I(QP^2):I(M^2)+AKRD:M:QP:I(QP^2)
\end_layout

\begin_layout Plain Layout

           +AKRD:M:QP:I(QP^2):I(M^2), data=DW)
\end_layout

\begin_layout Plain Layout

summary(fq23)
\end_layout

\begin_layout Plain Layout

cf <- coef(fq23)
\end_layout

\begin_layout Plain Layout

DQX23 <- with(DW, cf[1]+cf[2]*AKRD+cf[3]*M+cf[4]*QP+cf[5]*QP^2+cf[6]*AKRD*M
\end_layout

\begin_layout Plain Layout

      +cf[7]*M*QP+cf[8]*QP*AKRD^2+cf[9]*M*QP^2
\end_layout

\begin_layout Plain Layout

      +cf[10]*QP^3+cf[11]*QP^2*AKRD^2+cf[12]*AKRD*M^2
\end_layout

\begin_layout Plain Layout

      +cf[13]*M^3+cf[14]*QP*M^2+cf[15]*QP^2*M^2+cf[16]*M*QP*AKRD^2+cf[17]*AKRD*M
*QP^2+cf[18]*AKRD*QP^3
\end_layout

\begin_layout Plain Layout

      +cf[19]*M*QP^2*AKRD^2+cf[20]*AKRD*M^3
\end_layout

\begin_layout Plain Layout

      +cf[21]*QP^2*AKRD^2*M^2+cf[22]*AKRD*M*QP^3+cf[23]*AKRD*M^3*QP^3)
\end_layout

\begin_layout Plain Layout

sd23 <- sd(DW$PSFD*(DW$DQP-DQX23), na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

hist(DW$PSFD*(DW$DQP-DQX23), breaks=200, xlim=c(-1,1))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

fq <- lm(DQP ~ AKRD+M+QP+I(QP^2)+AKRD:M+M:QP+QP:I(AKRD^2)+M:I(QP^2)+QP:I(QP^2)
\end_layout

\begin_layout Plain Layout

         +I(AKRD^2):I(QP^2)+AKRD:I(M^2)+M:I(M^2)+QP:I(M^2)+I(QP^2):I(M^2)
\end_layout

\begin_layout Plain Layout

         +M:QP:I(AKRD^2)+AKRD:M:I(QP^2)+AKRD:QP:I(QP^2)+M:I(AKRD^2):I(QP^2)
\end_layout

\begin_layout Plain Layout

         +AKRD:M:I(M^2)+M:QP:I(M^2)+I(AKRD^2):I(QP^2):I(M^2)+AKRD:M:QP:I(QP^2)
\end_layout

\begin_layout Plain Layout

         +AKRD:M:QP:I(QP^2):I(M^2), data=DW)
\end_layout

\begin_layout Plain Layout

fq <- lm (DQP ~ AKRD+M+QP+I(QP^2)+AKRD:M+M:QP+QP:I(AKRD^2)+M:I(QP^2)+QP:I(QP^2),
 data=DW)
\end_layout

\begin_layout Plain Layout

summary(fq)
\end_layout

\begin_layout Plain Layout

fq <- lm (DQP ~ QP+AKRD+M+QP:I(AKRD^2), data=DW)
\end_layout

\begin_layout Plain Layout

fq2 <- lm (DQP2 ~ QP2+AKRD+M2+QP2:I(AKRD^2), data=DW)
\end_layout

\begin_layout Plain Layout

summary(fq)
\end_layout

\begin_layout Plain Layout

anova(fq)
\end_layout

\begin_layout Plain Layout

cf <- coef(fq)
\end_layout

\begin_layout Plain Layout

cf2 <- coef (fq2)
\end_layout

\begin_layout Plain Layout

DQX <- with(DW, cf[1]+cf[2]*QP+cf[3]*AKRD+cf[4]*M+cf[5]*QP*AKRD^2)
\end_layout

\begin_layout Plain Layout

DQX2 <- with(DW, cf2[1]+cf2[2]*QP2+cf2[3]*AKRD+cf2[4]*M2+cf2[5]*QP2*AKRD^2)
\end_layout

\begin_layout Plain Layout

sd5 <- sd(DW$PSFD*(DW$DQP-DQX), na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DQ <- DW$PSFD * DQX
\end_layout

\begin_layout Plain Layout

dmean <- mean (DQ, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

dsd <- sd(DQ, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

dmeanX <- mean (DQX, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

dsdX <- sd (DQX, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$QC <- DW$QCF - DQ    # DQ is the error, so subtract it
\end_layout

\begin_layout Plain Layout

DW$PC <- DW$PSFD + DQ
\end_layout

\begin_layout Plain Layout

DQ2 <- DW$PSFRD * DQX2
\end_layout

\begin_layout Plain Layout

dmean2 <- mean (DQ2, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

dsd2 <- sd(DQ2, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$QC2 <- DW$QCFR - DQ2
\end_layout

\begin_layout Plain Layout

DW$PC2 <- DW$PSFRD + DQ2
\end_layout

\begin_layout Plain Layout

PCor <- DW$PSFD * PCorFunction (DW$PSFD, DW$QCF, DW$AKRD, "C130")
\end_layout

\begin_layout Plain Layout

PCorMean <- mean (PCor, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DPmean <- mean (DQ, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
New empirical fits
\end_layout

\begin_layout Standard
An overly complex fit with 23 coefficients, as listed in the R code, gave
 a parameterized representation of 
\begin_inset Formula $\Delta q$
\end_inset

 with standard deviation 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(sd23, 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa about the values given by LAMS via (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:delta-q"

\end_inset

).
 This was based on about 15,600 1-Hz measurements that, in addition to the
 chisquare test, met the requirements that TASX > 90, |ROLL|<5, and PITCH<20
\begin_inset Formula $^{\circ}$
\end_inset

(to eliminate some obviously bad measurements from the INS).
 The tests eliminated turns and times near takeoff and landing.
 This fit provides an indication of the approximate target standard deviation
 for the fit, but a much simpler fit is desirable because, even though all
 23 coefficients meet tests of significance 
\begin_inset Formula $p$
\end_inset

<0.001, there could well be complex interactions dependent on the particular
 flight profile or other peculiarities of the data that could lead to problems
 when extrapolated beyond the range of the measurements or to new data.
 For that reason, a much simpler fit was sought that could give almost as
 small a standard deviation about the reference measurements from LAMS.
 The approach was to consider analysis-of-variance tables as guides to selecting
 the factors accounting for significant parts of the total variance.
 A five-coefficient fit gave a residual standard deviation of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(sd5, 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa with 15575 degrees of freedom and accounted for 85% of the total variance
 (vs 90% for the 23-coefficient fit), so this appeared to be an acceptable
 compromise.
\begin_inset Foot
status open

\begin_layout Plain Layout
The residual variance was reduced by shifting the measured sequence of QCF
 forward in time by 105
\begin_inset space ~
\end_inset

ms, a reasonable value to compensate for the displacement of the LAMS measuremen
ts ahead of the aircraft.
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\Delta q}{p_{m}}=b_{0}+b_{1}\frac{q_{m}}{p_{m}}+b_{2}\frac{\alpha}{a_{r}}+b_{3}M+b_{4}\frac{q_{m}}{p_{m}}\left(\frac{\alpha}{a_{r}}\right)^{2}\label{eq:dq-fit}
\end{equation}

\end_inset

with coefficients {
\begin_inset Formula $b_{0-4}$
\end_inset

}={
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[1],6)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[2],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[3],8)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[4],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[5],6)}
\end_layout

\end_inset

} for the sensing pair producing PSFD and QCF.
 For that producing PSFRD and QCFR, the corresponding coefficients are {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[1],6)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[2],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[3],8)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[4],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[5],6)}
\end_layout

\end_inset

}.
\end_layout

\begin_layout Standard
The mean deduced error in measured dynamic pressure is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(dmean,2)}
\end_layout

\end_inset


\begin_inset Formula $\pm$
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(dsd,2)}
\end_layout

\end_inset

 for QCF, but it is much larger for QCFR, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(dmean2,2)}
\end_layout

\end_inset


\begin_inset Formula $\pm$
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(dsd2,2)}
\end_layout

\end_inset

.
 The mean error in ambient pressure (respectively PSFD and PSFRD) is therefore
 the negative of these values.
 These are the errors in the measurements, so to obtain corrected values
 these errors should be subtracted from the measured values; i.e., 
\begin_inset Formula $q_{c}=q_{m}-\Delta q$
\end_inset

 and 
\begin_inset Formula $p_{c}=p_{m}+\Delta q$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<TAS-check, include=TRUE, fig.cap='Comparison of airspeed calculated from
 the corrected dynamic and ambient pressure to the airspeed measured by
 LAMS.
 The dashed orange line is a 1:1 reference line.'>>=
\end_layout

\begin_layout Plain Layout

# recalculate TAS using corrected pressures:
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

TASQ <- TrueAirspeed (MachNumber (DW$PC, DW$QC, DW$EWX), DW$ATX, DW$EWX/DW$PC)
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$TASL, TASQ), xlab='LAMS-based TAS [m/s]', ylab='corrected-p
ressure TAS [m/s]', type='p', pch=20, col='blue')
\end_layout

\begin_layout Plain Layout

lines(c(70,160), c(70,160), lwd=3, lty=2, col='darkorange')
\end_layout

\begin_layout Plain Layout

meanDTAS <- mean (TASQ-DW$TASL, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

sdDTAS <- sd (TASQ-DW$TASL, na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
A test for consistency is that airspeed calculated from the corrected dynamic
 pressure and ambient pressure should match the airspeed measured by LAMS.
 Figure
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:TAS-check}
\end_layout

\end_inset

 shows that there is good agreement between these two measurements for cases
 where the LAMS-based airspeed meets the quality check discussed above,
 with mean difference of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(meanDTAS,4)}
\end_layout

\end_inset


\begin_inset Formula $\pm$
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(sdDTAS,2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

m/s.
\end_layout

\begin_layout Standard
These corrections are significantly different from those obtained earlier
 by Cooper et al.
\begin_inset space ~
\end_inset

(2014) and as revised in the Technical Note on Processing Algorithms.
 For this flight, the average correction applied to pressure using the old
 parameterization in the Processing Algorithms document would be 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(mean(PCor, na.rm=TRUE), 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa.
 This difference does not only occur at low level but also is present when
 measurements are restricted to those at pressure below 800
\begin_inset space ~
\end_inset

hPa.
 In comparison to the avionics-system pressure PS_A, the new parameterization
 gives mean values about 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(mean(DW$PC-DW$PS_A, na.rm=TRUE),2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa lower than PS_A, while the old parameterization gave mean values about
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(mean(DW$PSXC-DW$PS_A, na.rm=TRUE),2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

hPa lower.
 The original values were based on flight 8 from the 2011 project IDEAS-4,
 and for that flight the difference between the corrected pressure and PS_A
 was 
\begin_inset Formula $-1.08$
\end_inset


\begin_inset space ~
\end_inset

hPa, close to the value found for this flight using the new parameterization.
 The larger difference obtained using the old parameterization suggests
 that the characteristics of the aircraft have changed, either affecting
 the static defect of the research static ports, the radome, the sensor
 calibrations, or some unknown change.
 It may be useful to use the new parameterization for intervening C-130
 projects like WINTER and FRAPPE, but that needs further study.
\end_layout

\begin_layout Section
LAMS-based measurement of temperature
\begin_inset CommandInset label
LatexCommand label
name "sec:LAMS-based-measurement-of"

\end_inset


\end_layout

\begin_layout Subsection
Theory and data available
\end_layout

\begin_layout Standard
It was demonstrated in Cooper et al.
\begin_inset space ~
\end_inset

(2014) that the LAMS-measured airspeed 
\begin_inset Formula $v_{L}$
\end_inset

 can be used to measure the temperature in a way that is independent of
 any temperature sensor.
 One important aspect of this is that 
\begin_inset Formula $v_{l}$
\end_inset

, combined with the measurements of total pressure (
\begin_inset Formula $p_{t}$
\end_inset

) and of ambient pressure (
\begin_inset Formula $p$
\end_inset

), might provide a valid measurement of temperature in clouds.
 This independent measurement of temperature arises from the relationship
 between temperature and the speed of sound, because the Mach number (
\begin_inset Formula $M$
\end_inset

) can be determined from the measurements 
\begin_inset Formula $p_{t}$
\end_inset

 and 
\begin_inset Formula $p$
\end_inset

 so the speed of sound can be found from 
\begin_inset Formula $v_{L}/M$
\end_inset

.
 That measurement of temeperature will be explored in this section.
\end_layout

\begin_layout Standard
The equation leading to temperature, Eq.
\begin_inset space ~
\end_inset

(24) in Cooper et al.
\begin_inset space ~
\end_inset

(2014), is
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
T=\frac{v_{l}^{2}}{2c_{p}\left[\left(\frac{p_{t}}{p}\right)^{R_{a}/c_{p}}-1\right]}\label{eq:T-LAMS}
\end{equation}

\end_inset

where 
\begin_inset Formula $T$
\end_inset

 is the temperature on an absolute-temperature scale, 
\begin_inset Formula $c_{p}$
\end_inset

 is the specific heat of air at constant pressure, and 
\begin_inset Formula $R_{a}$
\end_inset

 is the gas constant for air.
 For a selected region with strong LAMS signals in clear air, the resulting
 temperature (converted to 
\begin_inset Formula $^{\circ}$
\end_inset

C) was on average 1.4
\begin_inset Formula $^{\circ}$
\end_inset

C lower than the standard temperature ATX.
 However, this result is very sensitive to 
\begin_inset Formula $v_{L}$
\end_inset

 and increasing 
\begin_inset Formula $v_{l}$
\end_inset

 by 0.35 m/s (the measured difference between 
\begin_inset Formula $v_{L}$
\end_inset

 and TASX) completely removed the offset.
 That may be an indication that the airspeed from LAMS shows a small effect
 from airflow distortion even though the beams are displaced XXX m ahead
 of the instrument.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<T-comparison, include=FALSE, fig.cap='LAMS-derived temperature (TL) vs
 the standard measurement (ATX) for ARISTO-2015 flight 4, 19:12:00--19:30:00
 UTC.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRDataC <- sprintf ('%sC.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf04_LAMS"
\end_layout

\begin_layout Plain Layout

  Project <- 'ARISTO'
\end_layout

\begin_layout Plain Layout

  Directory <- DataDirectory ()
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList)))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataC)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataC)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 191200, 193000)
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSXC, DW$QCXC, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

DW <- DW[r, ]
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSXC)
\end_layout

\begin_layout Plain Layout

cpa <- CP[,1]
\end_layout

\begin_layout Plain Layout

Ra <- CP[,3]
\end_layout

\begin_layout Plain Layout

cva <- CP[,2]
\end_layout

\begin_layout Plain Layout

gamma <- cpa/cva
\end_layout

\begin_layout Plain Layout

Vs <- (DW$TASL) / DW$Mach
\end_layout

\begin_layout Plain Layout

TL <- Vs^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

# TL <- DW$TASL^2 / (2*cpa * (((DW$PSXC+DW$QCXC)/DW$PSXC)^(Ra/cpa) - 1))
 - 273.15
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$ATX, TL), xlab='ATX', ylab='LAMS-based T', pch=20,
 type='p', xlim=c(-5,-2), ylim=c(-20,10))
\end_layout

\begin_layout Plain Layout

cflt <- coef (lm (TL ~ DW$ATX))
\end_layout

\begin_layout Plain Layout

xt <- c(-10,10)
\end_layout

\begin_layout Plain Layout

yt <- cflt[1] + cflt[2]*xt
\end_layout

\begin_layout Plain Layout

lines (xt, yt, col='darkorange', lwd=3, lty=2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
To investigate the performance of this measurement of temperature in cloud,
 the in-cloud measurements from ARISTO-2015 and ARISTO-2016 (flight 6 only)
 were examined.
 The in-cloud measurements included those in the following table, along
 with a few other brief passes through rain, ice, or cloud.
 There were a large number of cloud passes (>27) in ARISTO-2016 flight 6,
 but only three examples are included in the table and discussed in this
 report.
 
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="14" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
flight
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
start
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
end
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
nature of cloud
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
performance of LAMS
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
173000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
173800
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
warm, no 2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
mostly NG
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
174145
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
174600
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
warm, no 2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
maybe OK
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
184740
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
184830
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
only 2D; cold
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OK
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
173000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
warm; high 2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
sporadic, weak
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
181000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
182000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
repeated cloud, warm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
questionable, maybe OK
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200900
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
201000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
short, warm cloud
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS good
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
171500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
172500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cold, ice
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS mostly OK
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
173000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
174500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cold, ice
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Beam1 NG, others weak
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
170600
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
171100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
near 0C, short
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Beam2 OK; Beam1 gaps
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
182200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
182400
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2D only; cold
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
LAMS NG
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2016-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
230510
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
230620
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2016-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
240250
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
240415
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2016-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
250040
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
250130
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-1, include=TRUE, fig.cap='The temperature deduced from the measurement
 obtained using the LAMS-measured airspeed (magenta dots), adjusted as described
 in the text, and plotted with a smoothed version (TLS) and with the standard
 measurement of temperature (ATX).
 The measurements from periods where the CDP concentration exceeded 5
\backslash

\backslash
_cm$^{-3}$ are shown as thicker lines plotted, in the case of ATX, in a
 different color.', fig.height=4, cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRDataD <- sprintf ('%sD.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf03_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory, ProjectDir, Project, Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList, "CONCD_RPT")))
\end_layout

\begin_layout Plain Layout

  ## these points appear to be bad, beam 2:
\end_layout

\begin_layout Plain Layout

  Data$BEAM2speed[getIndex(Data, 200951)] <- NA
\end_layout

\begin_layout Plain Layout

  Data$BEAM2speed[getIndex(Data, 200948)] <- NA
\end_layout

\begin_layout Plain Layout

  Data$BEAM2speed[getIndex(Data, 200954)] <- NA
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataD)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataD)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

PCA <- FALSE    ## use SG polynomial solution
\end_layout

\begin_layout Plain Layout

# PCA <- TRUE     ## use PCA solution
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$CONCD <- Data$CONCD_RPT
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 200830, 201030)
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSXC, DW$QCXC, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

## temporary: use beam 2 only
\end_layout

\begin_layout Plain Layout

# DW$TASL <- DW$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASL3 <- (Data$BEAM1speed + DW$BEAM3speed + DW$BEAM4speed) / (3 * cos
 (35*pi/180))
\end_layout

\begin_layout Plain Layout

DW$TASL1 <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

DW <- DW[r, ]
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSXC)
\end_layout

\begin_layout Plain Layout

cpa <- CP[,1]
\end_layout

\begin_layout Plain Layout

Ra <- CP[,3]
\end_layout

\begin_layout Plain Layout

cva <- CP[,2]
\end_layout

\begin_layout Plain Layout

gamma <- cpa/cva
\end_layout

\begin_layout Plain Layout

DTAS <- with(DW, mean (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS3 <- with (DW, mean (TASX-TASL3, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS1 <- with (DW, mean (TASX-TASL1, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

Vs <- (DW$TASL + DTAS) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs3 <- (DW$TASL3 + DTAS3) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs1 <- (DW$TASL1 + DTAS1) / DW$Mach
\end_layout

\begin_layout Plain Layout

TL <- Vs^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL3 <- Vs3^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL1 <- Vs1^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

LS <- 13
\end_layout

\begin_layout Plain Layout

TLS <- SmoothInterp (TL, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS1 <- SmoothInterp (TL1, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS3 <- SmoothInterp (TL3, .Length=LS)
\end_layout

\begin_layout Plain Layout

# TL <- DW$TASL^2 / (2*cpa * (((DW$PSXC+DW$QCXC)/DW$PSXC)^(Ra/cpa) - 1))
 - 273.15
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$Time, ATX, TLS), ylab='Temperature [C]', 
\end_layout

\begin_layout Plain Layout

        ylim=c(5,17), lwd=c(2,2), lty=c(1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

TLS[Excl] <- NA
\end_layout

\begin_layout Plain Layout

lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

lines (DW$Time+0.5, TLS, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Case studies
\end_layout

\begin_layout Subsubsection
Case 1: Flight 3, 20:09:00 to 20:10:00
\end_layout

\begin_layout Standard
Flight 3, 20:09:00 to 20:10:00, is a short pass through a warm cloud with
 no ice or rain.
 Close inspection of the forward-pointing beam (beam 2) indicates that there
 are a few bad points in the center of this cloud, at times 20:09:48, 20:09:51.
 and 20:09:54, so these were set missing and then interpolation was used
 to fill in missing points in this time period.
\begin_inset Foot
status open

\begin_layout Plain Layout
Beam 2 appeared to be affected in cloud more than the other beams, perhaps
 because of water striking and remaining on the forward-pointing aperture
 more than on the other beams pointing 35
\begin_inset Formula $^{\circ}$
\end_inset

 from the forward direction.
\end_layout

\end_inset

 The mean difference between airspeed determined in the conventional way
 and airspeed from LAMS was 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(DTAS, 2)}
\end_layout

\end_inset


\begin_inset space ~
\end_inset

m/s, consistent with the value found in the clear-air flight segment used
 in the preceding paragraph.
 To make it easier to judge differences produced by the cloud, this mean
 value was added to the LAMS-measured airspeeds and then smoothing over
 approximately a 5-s period was applied to the temperature calculated from
 the LAMS airspeed.
 The resulting temperature measurement for the cloud pass is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-1}
\end_layout

\end_inset

, where the magenta-colored points are the unsmoothed measurements of temperatur
e.
 The unsmoothed measurement is quite noisy, so smoothing is important in
 order to see trends.
\begin_inset Foot
status open

\begin_layout Plain Layout
ATX is not smoothed, but it is thought to have a response time between 2
 and 3 s.
\end_layout

\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Despite the noisy signal, particularly in the vicinity of the clouds, the
 LAMS-based temperature shows good correlation with the standard temperature.
 There is also a suggestion of a trend in the cloud passes: As the cloud
 pass proceeds, ATX tends to become lower relative to TLS.
 Because of the variability present, this is only suggestive, but there
 is some match to what would be expected if the ATX sensor (in this case,
 a HARCO anti-iced sensor) becomes wet in cloud because in that case evaporative
 cooling from the element in the dynamically heated and therefore <100%-humidity
 air in the housing causes an error of negative sign.
\end_layout

\begin_layout Subsubsection
Case 2: Flight 2, 17:30:00–19:20:00 
\end_layout

\begin_layout Standard
Next, the long cloud pass from flight 2 was examined.
 These measurements were from a low-level flight leg (near 7000 ft) at high
 temperature, >10
\begin_inset Formula $^{\circ}$
\end_inset

C, and there were high concentrations of particles measured by the 2DC.
 The LAMS-measured line-of-sight speeds were not always reliable,but it
 was possible to select regions of strong and apparently consistent signals
 from this long cloud pass.
 CDP-measured concentrations were often several hundred cm
\begin_inset Formula $^{-3}$
\end_inset

, and 2D-measured concentrations ranged from 1–100
\begin_inset space ~
\end_inset

L
\begin_inset Formula $^{-1}$
\end_inset

.
 
\end_layout

\begin_layout Standard
As was the case for the flight-3 case examined above, beam 2 appears to
 be more noisy than the other beams, and there are some cases where beam
 1 (looking downward) appears to be affected by returns from the ground.
 Because the measurement of airspeed is over-constrained in the case of
 valid measurements from four beams, it is possible to use a chisquare test
 of consistency among the four beams as a test of validity of the solution.
 The chisquare for the solution was developed in the LAMSprocessing4Bwind.pdf
 memo:
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\chi^{2}=\sum_{i}\frac{(a_{i}^{\prime}-a_{i})^{2}}{\sigma^{2}}\label{eq:chisquare}
\end{equation}

\end_inset

where 
\begin_inset Formula $a_{i}^{\prime}$
\end_inset

 are the line-of-sight airspeeds measured in the four beams and 
\begin_inset Formula $a_{i}$
\end_inset

 are the corresponding airspeeds determined using the direction-cosine matrix
 for the four beams and the best-fit result for the vector wind.
 For the four-beam case, the solution for the vector wind is 
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathbf{v}=\mathbf{Ma^{\prime}}\label{eq:4beamsoln}
\end{equation}

\end_inset

and
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\mathbf{a}=\mathbf{Sv}\label{eq:DCMeq}
\end{equation}

\end_inset

where 
\begin_inset Formula $\mathbf{M}$
\end_inset

 and 
\begin_inset Formula $\mathbf{S}$
\end_inset

 are given by Eqs.
\begin_inset space ~
\end_inset

9 and 2 from that earlier memo.
 The solution to (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chisquare"

\end_inset

) is then given by
\begin_inset Newline newline
\end_inset


\begin_inset Formula 
\begin{equation}
\chi^{2}=\frac{1}{\sigma^{2}}\sum_{i}(a_{i}^{\prime}-S_{ij}v_{j})^{2}\label{eq:chi-2}
\end{equation}

\end_inset

Code to calculate this value, using 
\begin_inset Formula $\sigma$
\end_inset

=1, is included in the 
\begin_inset Quotes eld
\end_inset

ProcessWind()
\begin_inset Quotes erd
\end_inset

 function in this code.
 For the region from flight 3 shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-1}
\end_layout

\end_inset

, the mean value was 0.16
\begin_inset space ~
\end_inset

m
\begin_inset Formula $^{2}$
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

, so these 4-beam measurements were reasonably consistent, but there were
 five outliers with values exceeding 1
\begin_inset space ~
\end_inset

m
\begin_inset Formula $^{2}$
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

 that should be excluded as being inconsistent among the four beams.
 The value of 
\begin_inset Formula $\chi^{2}$
\end_inset

 can thus be used to identify regions where the 4-beam solution is questionable,
 and a requirement that it be smaller than about 0.5
\begin_inset space ~
\end_inset

m
\begin_inset Formula $^{2}$
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

appears reasonable on the basis of values from good flight segments.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-2, include=TRUE, fig.cap='(top) The difference between the LAMS-derived
 airspeed (TASL) and the conventional airspeed (TASX), for the period from
 17:39:00--17:46:00 from ARISTO-2015 flight 2.
 (bottom) The RMS error for the fit to the four measured line-of-sight beam
 speeds, for the same flight segment.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRDataE <- sprintf ('%sE.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf02_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList, "CONCD_RPT", "PLWCD_RPT
")))
\end_layout

\begin_layout Plain Layout

  ## these points appear to be bad, beam 2:
\end_layout

\begin_layout Plain Layout

  # Data$BEAM2speed[getIndex(Data, 200951)] <- NA
\end_layout

\begin_layout Plain Layout

  # Data$BEAM2speed[getIndex(Data, 200948)] <- NA
\end_layout

\begin_layout Plain Layout

  # Data$BEAM2speed[getIndex(Data, 200954)] <- NA
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataE)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataE)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

PCA <- FALSE    ## use SG polynomial solution
\end_layout

\begin_layout Plain Layout

PCA <- TRUE     ## use PCA solution
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$RMS <- sqrt (DW$TASCSQ / 4)
\end_layout

\begin_layout Plain Layout

DW$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$CONCD <- Data$CONCD_RPT
\end_layout

\begin_layout Plain Layout

DW$PLWCD <- Data$PLWCD_RPT
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 173000, 192000)
\end_layout

\begin_layout Plain Layout

rt <- setRange (DW$Time, 173900, 174500)
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSXC, DW$QCXC, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

## temporary: use beam 2 only
\end_layout

\begin_layout Plain Layout

# DW$TASL <- DW$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASL3 <- (Data$BEAM1speed + DW$BEAM3speed + DW$BEAM4speed) / (3 * cos
 (35*pi/180))
\end_layout

\begin_layout Plain Layout

DW$TASL1 <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

## reject and interpolate at points with high RMS
\end_layout

\begin_layout Plain Layout

RMStest <- 0.3
\end_layout

\begin_layout Plain Layout

DW$TASL[DW$RMS > 0.2] <- NA
\end_layout

\begin_layout Plain Layout

DW$TASL <- zoo::na.approx(DW$TASL, na.rm=FALSE)
\end_layout

\begin_layout Plain Layout

# DW <- DW[r, ]
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSXC)
\end_layout

\begin_layout Plain Layout

cpa <- CP[,1]
\end_layout

\begin_layout Plain Layout

Ra <- CP[,3]
\end_layout

\begin_layout Plain Layout

cva <- CP[,2]
\end_layout

\begin_layout Plain Layout

gamma <- cpa/cva
\end_layout

\begin_layout Plain Layout

DTAS <- with(DW[rt, ], mean (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS3 <- with (DW[rt, ], mean (TASX-TASL3, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS1 <- with (DW[rt, ], mean (TASX-TASL1, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

Vs <- (DW$TASL + DTAS) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs3 <- (DW$TASL3 + DTAS3) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs1 <- (DW$TASL1 + DTAS1) / DW$Mach
\end_layout

\begin_layout Plain Layout

TL <- Vs^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL3 <- Vs3^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL1 <- Vs1^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

LS <- 13
\end_layout

\begin_layout Plain Layout

TLS <- SmoothInterp (TL, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS1 <- SmoothInterp (TL1, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS3 <- SmoothInterp (TL3, .Length=LS)
\end_layout

\begin_layout Plain Layout

# TL <- DW$TASL^2 / (2*cpa * (((DW$PSXC+DW$QCXC)/DW$PSXC)^(Ra/cpa) - 1))
 - 273.15
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

# plotWAC(data.frame(DW$Time, ATX, TLS), ylab='Temperature [C]', 
\end_layout

\begin_layout Plain Layout

#         ylim=c(5,17), lwd=c(2,2), lty=c(1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

# Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

# ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# TLS[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, TLS, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

# op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

# plotWAC(subset(DW,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

plotWAC (data.frame (DW$Time, DW$TASL-DW$TASX)[rt, ], ylab='TASL-TASX', ylim=c(-1
,1))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

with (DW[rt, ], plotWAC (Time, RMS, ylim=c(0,0.5), ylab='RMS [m/s]'))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-3, include=TRUE, fig.cap='For the same flight period shown in the
 previous figure, the temperature deduced from the measurement obtained
 using the LAMS-measured airspeed (dark green line), adjusted as described
 in the text, plotted with the standard measurement of temperature (ATX).
 The measurements from periods where the CDP concentration exceeded 5
\backslash

\backslash
 cm$^{-3}$ are shown as thicker lines plotted, in the case of ATX, in a
 different color.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

DW$TLS <-TLS
\end_layout

\begin_layout Plain Layout

rt1 <- setRange (DW, 173900, 174200)
\end_layout

\begin_layout Plain Layout

rt2 <- setRange (DW, 174300, 174500)
\end_layout

\begin_layout Plain Layout

meanC <- with (DW[rt1, ], mean (TLS-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

meanE <- with (DW[rt2, ], mean (TLS-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DW <- DW[rt, ]
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

plotWAC(data.frame(DW$Time, DW$ATX, DW$TLS), ylab='Temperature [C]', 
\end_layout

\begin_layout Plain Layout

        ylim=c(5,17), lwd=c(2,2), lty=c(1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

DW$ATXE <- DW$ATX
\end_layout

\begin_layout Plain Layout

DW$TLSE <- DW$TLS
\end_layout

\begin_layout Plain Layout

DW$ATXE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

DW$TLSE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

lines (DW$Time+0.5, DW$ATXE, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

lines (DW$Time+0.5, DW$TLSE, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-4, include=TRUE, fig.cap='Dependence of the difference between the
 LAMS-derived temperature (TLS) and the standard temperature (ATX) as a
 function of the liquid water content measured by the CDP (PLWCD), for the
 same flight period shown in the preceding two plots.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

layout(matrix(1:1, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1))
\end_layout

\begin_layout Plain Layout

plot(DW$PLWCD, DW$TLS-DW$ATX, pch=20, col='blue')
\end_layout

\begin_layout Plain Layout

cflw <- coef (lm (DW$TLS-DW$ATX ~ DW$PLWCD))
\end_layout

\begin_layout Plain Layout

xx <- c(0,0.3)
\end_layout

\begin_layout Plain Layout

yy <- cflw[1] + cflw[2] * xx
\end_layout

\begin_layout Plain Layout

lines (xx, yy, col='darkorange', lty=2, lwd=3)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-2}
\end_layout

\end_inset

 shows a segment from this flight for which the measurements appear consistent
 among the four beams, especially for the last 2-min period that is not
 in cloud.
 This flight segment was selected because the LAMS measurements are mostly
 consistent with the standard airspeed and have low RMS.
 Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-3}
\end_layout

\end_inset

 shows the corresponding measurements of temperature from the two sources
 and also the droplet concentration.
 The in-cloud LAMS temperature is on average slightly lower than the standard
 temperature, by about 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(meanC,2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

C, while the out-of-cloud measurements are offset in the other direction,
 with a mean difference of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(meanE,2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

C.
 There is some correlation between the temperature difference and the liquid
 water content, as shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-4}
\end_layout

\end_inset

.
 The observed difference is in the opposite direction to that expected if
 ATX is cooled as a result of wetting of the sensor, so this result is not
 an indication of sensor wetting.
 An alternate explanation might be that the returned signal has greater
 contributions from locations closer to the LAMS in the high-backscatter
 of a cloud, so that the airspeed and hence temperature is biased low in
 such a region, with the bias increasing with the density of the cloud.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Case 3: Flight 3, 18:10:00–18:20:00
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-5, include=TRUE, fig.cap='(top) The difference between the LAMS-derived
 airspeed (TASL) and the conventional airspeed (TASX), for the period from
 18:10:00--18:20:00 from ARISTO-2015 flight 3.
 (bottom) The RMS error for the fit to the four measured line-of-sight beam
 speeds, for the same flight segment.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SaveRDataF <- sprintf ('%sF.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Flight <- "rf03_LAMS"
\end_layout

\begin_layout Plain Layout

  fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList, "CONCD_RPT", "PLWCD_RPT
")))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataF)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataF)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

## these points appear to be bad, beam 2:
\end_layout

\begin_layout Plain Layout

# Data$BEAM2speed[getIndex(Data, 200951)] <- NA
\end_layout

\begin_layout Plain Layout

# Data$BEAM2speed[getIndex(Data, 200948)] <- NA
\end_layout

\begin_layout Plain Layout

# Data$BEAM2speed[getIndex(Data, 200954)] <- NA
\end_layout

\begin_layout Plain Layout

PCA <- FALSE    ## use SG polynomial solution
\end_layout

\begin_layout Plain Layout

PCA <- TRUE     ## use PCA solution
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$RMS <- sqrt (DW$TASCSQ / 4)
\end_layout

\begin_layout Plain Layout

DW$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$CONCD <- Data$CONCD_RPT
\end_layout

\begin_layout Plain Layout

DW$PLWCD <- Data$PLWCD_RPT
\end_layout

\begin_layout Plain Layout

DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

rt <- setRange (DW$Time, 181000, 182000)
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSXC, DW$QCXC, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

## temporary: use beam 2 only
\end_layout

\begin_layout Plain Layout

# DW$TASL <- DW$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASL3 <- DW$TASX3  ## (Data$BEAM1speed + DW$BEAM3speed + DW$BEAM4speed)
 / (3 * cos (35*pi/180))
\end_layout

\begin_layout Plain Layout

DW$TASL1 <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

## reject and interpolate at points with high RMS
\end_layout

\begin_layout Plain Layout

RMStest <- 0.3
\end_layout

\begin_layout Plain Layout

DW$TASL[DW$RMS > 0.2] <- NA
\end_layout

\begin_layout Plain Layout

DW$TASL <- zoo::na.approx(DW$TASL, na.rm=FALSE)
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSXC)
\end_layout

\begin_layout Plain Layout

cpa <- CP[,1]
\end_layout

\begin_layout Plain Layout

Ra <- CP[,3]
\end_layout

\begin_layout Plain Layout

cva <- CP[,2]
\end_layout

\begin_layout Plain Layout

gamma <- cpa/cva
\end_layout

\begin_layout Plain Layout

DTAS <- with(DW[rt, ], mean (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS3 <- with (DW[rt, ], mean (TASX-TASL3, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS1 <- with (DW[rt, ], mean (TASX-TASL1, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

Vs <- (DW$TASL + DTAS) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs3 <- (DW$TASL3 + DTAS3) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs1 <- (DW$TASL1 + DTAS1) / DW$Mach
\end_layout

\begin_layout Plain Layout

TL <- Vs^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL3 <- Vs3^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL1 <- Vs1^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

LS <- 13
\end_layout

\begin_layout Plain Layout

TLS <- SmoothInterp (TL, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS1 <- SmoothInterp (TL1, .Length=LS)
\end_layout

\begin_layout Plain Layout

TLS3 <- SmoothInterp (TL3, .Length=LS)
\end_layout

\begin_layout Plain Layout

# TL <- DW$TASL^2 / (2*cpa * (((DW$PSXC+DW$QCXC)/DW$PSXC)^(Ra/cpa) - 1))
 - 273.15
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

# plotWAC(data.frame(DW$Time, ATX, TLS), ylab='Temperature [C]', 
\end_layout

\begin_layout Plain Layout

#         ylim=c(5,17), lwd=c(2,2), lty=c(1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

# Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

# ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# TLS[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, TLS, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

# op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

# plotWAC(subset(DW,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

plotWAC (data.frame (DW$Time, DW$TASL-DW$TASX)[rt, ], ylab='TASL-TASX', ylim=c(-5
,5))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

with (DW[rt, ], plotWAC (Time, RMS, ylim=c(0,0.5), ylab='RMS [m/s]'))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-6, include=TRUE, fig.cap='For the subset of the flight period shown
 in the previous figure from 18:12:30--18:14:00, the temperature deduced
 from the measurement obtained using the LAMS-measured airspeed (TLS, dark
 green line), adjusted as described in the text, plotted with the standard
 measurement of temperature (ATX).
 The measurements from periods where the CDP concentration exceeded 5
\backslash

\backslash
_cm$^{-3}$ are shown as thicker lines.
 The red line on this plot (TLSG) shows the periods where TLS was based
 on measurements with RMS smaller than 0.2 m/s.
 The cyan line (TLS1) is the result based only on the forward-pointing beam
 2, and the orange line (TLS3) is the result based on the 3-beam result
 using beams 1, 3, and 4.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

DW$TLS <-TLS
\end_layout

\begin_layout Plain Layout

DW$TLS1 <- TLS1
\end_layout

\begin_layout Plain Layout

DW$TLS3 <- TLS3
\end_layout

\begin_layout Plain Layout

DW$TLSG <- TLS
\end_layout

\begin_layout Plain Layout

DW$TLSG[DW$RMS > 0.2] <- NA
\end_layout

\begin_layout Plain Layout

# rt1 <- setRange (DW, 173900, 174200)
\end_layout

\begin_layout Plain Layout

# rt2 <- setRange (DW, 174300, 174500)
\end_layout

\begin_layout Plain Layout

# meanC <- with (DW[rt1, ], mean (TLS-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

# meanE <- with (DW[rt2, ], mean (TLS-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

rt <- setRange (DW, 181230, 181400)
\end_layout

\begin_layout Plain Layout

DW1 <- DW[rt, ]
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW1,, c(Time, ATX, TLS, TLSG, TLS1, TLS3)), ylab='Temperature
 [C]', 
\end_layout

\begin_layout Plain Layout

        lwd=c(2,2,3,2,2), lty=c(1,2,1,1,1), legend.position='topleft')
\end_layout

\begin_layout Plain Layout

Excl <- DW1$CONC < 5
\end_layout

\begin_layout Plain Layout

DW1$ATXE <- DW1$ATX
\end_layout

\begin_layout Plain Layout

DW1$TLSE <- DW1$TLS
\end_layout

\begin_layout Plain Layout

DW1$ATXE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

DW1$TLSE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

lines (DW1$Time+0.5, DW1$ATXE, lwd=4, col='blue')
\end_layout

\begin_layout Plain Layout

lines (DW1$Time+0.5, DW1$TLSE, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

# points (DW1$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW1,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The third case examined here is a series of passes through clouds at temperature
s near freezing.
 Droplet concentrations were often several 100/cm
\begin_inset Formula $^{3}$
\end_inset

, and there were 2D particles often in concentrations of 1–10/L.
 The cloud pass near 18:13 was a more dense cloud than those presented above,
 with droplet concentrations around 400
\begin_inset space ~
\end_inset

cm
\begin_inset Formula $^{-3}$
\end_inset

 and liquid water content above 0.6
\begin_inset space ~
\end_inset

g
\begin_inset space \thinspace{}
\end_inset

m
\begin_inset Formula $^{-3}$
\end_inset

.
 It serves as a good illustration of the problems with LAMS that occur in
 a dense cloud.
 The measurements of airspeed and the associated RMS for this flight period
 is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST5}
\end_layout

\end_inset

, and the associated measuirement of temperature for the pass through particular
ly dense cloud is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-6}
\end_layout

\end_inset

.
 In this dense cloud, the RMS for the four-beam measurements became >0.5
 inside the cloud, the LAMS-measured airspeed was about 2
\begin_inset space ~
\end_inset

m/s below the conventional measurement, and as a result the LAMS-measured
 temperature was as much as 10
\begin_inset Formula $^{\circ}$
\end_inset

C below the standard temperature ATX.
 However, this large error arose mostly from beam 2, which alone would give
 an error of more than 30
\begin_inset Formula $^{\circ}$
\end_inset

C.
 If instead airspeed is determined using the three beams slanted into the
 wind by about 35
\begin_inset Formula $^{\circ}$
\end_inset

, the result (plotted as TLS3, the orange line in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-6}
\end_layout

\end_inset

) shows a smaller but still significant negative bias relative to ATX.
 This shows the value of using four beams and applying an RMS test to exclude
 bad measurements, because the measurements were quite seriously biased
 in this dense cloud and only this RMS test was able to identify the regions
 where measurements are unreliable.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-7, include=TRUE, fig.cap='Same as in the previous plot, but for a
 later portion of the flight segment.
 See the caption for the previous plot.', cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

rt <- setRange (DW, 181500, 182000)
\end_layout

\begin_layout Plain Layout

DW1 <- DW[rt, ]
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW1,, c(Time, ATX, TLS, TLSG, TLS1, TLS3)), ylab='Temperature
 [C]', 
\end_layout

\begin_layout Plain Layout

        lwd=c(2,2,3,2,2), lty=c(1,2,1,1,1), legend.position='topleft')
\end_layout

\begin_layout Plain Layout

Excl <- DW1$CONC < 5
\end_layout

\begin_layout Plain Layout

DW1$ATXE <- DW1$ATX
\end_layout

\begin_layout Plain Layout

DW1$TLSE <- DW1$TLS
\end_layout

\begin_layout Plain Layout

DW1$ATXE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

DW1$TLSE[Excl] <- NA
\end_layout

\begin_layout Plain Layout

lines (DW1$Time+0.5, DW1$ATXE, lwd=4, col='blue')
\end_layout

\begin_layout Plain Layout

lines (DW1$Time+0.5, DW1$TLSE, lwd=4, col='darkgreen')
\end_layout

\begin_layout Plain Layout

# points (DW1$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW1,, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

meanE <- with(DW1[DW1$CONCD < 5,], mean(TLS3-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

meanC <- with(DW1[DW1$CONCD >= 5,], mean(TLS3-ATX, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-7}
\end_layout

\end_inset

 shows a similar plot for a subsequent period of flight through this sequence
 of small clouds.
 The temperature based only on beam 2 is again strongly affected and evidently
 too low in this sequence of weaker clouds.
 However, it has less influence on the 4-beam solution, and both the 4-beam
 and the 3-beam solution appear reasonable.
 The difference between the 3-beam solution (TLS3) and ATX is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(meanE,2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

C for locations out-of-cloud but 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(meanC, 2)}
\end_layout

\end_inset


\begin_inset Formula $^{\circ}$
\end_inset

C for in-cloud measurements.
 Because errors in the LAMS-derived temperature are negative when influenced
 by cloud, these differences suggest possible evaporative-cooling influence
 on the standard temperature probes.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Case 4: Flight 2016-6, 23:05:00 – 23:06:20
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<ARISTO2016-T, include=TRUE, cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Flight <- "rf06"
\end_layout

\begin_layout Plain Layout

Directory <- DataDirectory ()
\end_layout

\begin_layout Plain Layout

ProjectDir <- 'ARISTO'
\end_layout

\begin_layout Plain Layout

Project <- 'ARISTO2016'
\end_layout

\begin_layout Plain Layout

fname = sprintf("%s%s/%s%sLAMS.nc", Directory, ProjectDir, Project, Flight)
\end_layout

\begin_layout Plain Layout

VarList16 <- c(VarList[-9:-12], 'WIC')
\end_layout

\begin_layout Plain Layout

SaveRDataG <- sprintf ('%sG.Rdata', thisFileName)
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Data <- getNetCDF (fname, standardVariables(c(VarList16, "CONCD_RWT")))
\end_layout

\begin_layout Plain Layout

  save (Data, file=SaveRDataG)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load (SaveRDataG)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

PCA <- FALSE    ## use SG polynomial solution
\end_layout

\begin_layout Plain Layout

# PCA <- TRUE     ## use PCA solution
\end_layout

\begin_layout Plain Layout

DW <- processWind(Data)
\end_layout

\begin_layout Plain Layout

DW$BEAM2speed <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$PSXC <- Data$PSXC
\end_layout

\begin_layout Plain Layout

DW$QCXC <- Data$QCXC
\end_layout

\begin_layout Plain Layout

DW$ATX <- Data$ATX
\end_layout

\begin_layout Plain Layout

DW$CONCD <- Data$CONCD_RWT
\end_layout

\begin_layout Plain Layout

# DW$AKRDF <- cf4[1] + DW$ADIFR/DW$QCF * (cf4[2] + cf4[3] * MachNumber (DW$PSF,
 DW$QCF, DW$EWX))
\end_layout

\begin_layout Plain Layout

DW$QR <- DW$ADIFR / DW$QCF
\end_layout

\begin_layout Plain Layout

DW$Mach <- MachNumber (DW$PSXC, DW$QCXC, DW$EWX)
\end_layout

\begin_layout Plain Layout

DW$TASL <- DW$TASX
\end_layout

\begin_layout Plain Layout

## temporary: use beam 2 only
\end_layout

\begin_layout Plain Layout

# DW$TASL <- DW$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASL3 <- (Data$BEAM1speed + DW$BEAM3speed + DW$BEAM4speed) / (3 * cos
 (35*pi/180))
\end_layout

\begin_layout Plain Layout

DW$TASL1 <- Data$BEAM2speed
\end_layout

\begin_layout Plain Layout

DW$TASX <- Data$TASX
\end_layout

\begin_layout Plain Layout

CP <- SpecificHeats (DW$EWX / DW$PSXC)
\end_layout

\begin_layout Plain Layout

cpa <- CP[,1]
\end_layout

\begin_layout Plain Layout

Ra <- CP[,3]
\end_layout

\begin_layout Plain Layout

cva <- CP[,2]
\end_layout

\begin_layout Plain Layout

gamma <- cpa/cva
\end_layout

\begin_layout Plain Layout

DTAS <- with(DW, mean (TASX-TASL, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS3 <- with (DW, mean (TASX-TASL3, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

DTAS1 <- with (DW, mean (TASX-TASL1, na.rm=TRUE))
\end_layout

\begin_layout Plain Layout

Vs <- (DW$TASL + DTAS) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs3 <- (DW$TASL3 + DTAS3) / DW$Mach
\end_layout

\begin_layout Plain Layout

Vs1 <- (DW$TASL1 + DTAS1) / DW$Mach
\end_layout

\begin_layout Plain Layout

TL <- Vs^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL3 <- Vs3^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

TL1 <- Vs1^2 / (gamma * Ra) - 273.15
\end_layout

\begin_layout Plain Layout

LS <- 9
\end_layout

\begin_layout Plain Layout

DW$TLS <- SmoothInterp (TL, .Length=LS)
\end_layout

\begin_layout Plain Layout

DW$TLS1 <- SmoothInterp (TL1, .Length=LS)
\end_layout

\begin_layout Plain Layout

DW$TLS3 <- SmoothInterp (TL3, .Length=LS)
\end_layout

\begin_layout Plain Layout

DW$TLSG <- DW$TLS
\end_layout

\begin_layout Plain Layout

# TL <- DW$TASL^2 / (2*cpa * (((DW$PSXC+DW$QCXC)/DW$PSXC)^(Ra/cpa) - 1))
 - 273.15
\end_layout

\begin_layout Plain Layout

DWsave <- DW
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-8, include=TRUE, fig.cap='The temperature deduced from the measurement
 obtained using the LAMS-measured airspeed (TLS, dashed green line), adjusted
 as described in the text, plotted with the standard measurement of temperature
 (ATX).
 Where the chisquare of the fit (as defined in the text) was larger than
 0.1, the line is plotted as a solid line (TLSG).
 Also shown is the temperature determined using only the three off-axis
 beams (TLS3, red line).
 Data from ARISTO-2016 flight 6, 23:05:00 -- 24:06:20 UTC.', fig.height=4.5>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 205500, 212000)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 212000, 213500)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 225700, 230000)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 230000, 230100)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 230200, 230300)
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 230500, 230620)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 230830, 230900)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 230940, 231030)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 231100, 231130)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 231145, 231210)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240250, 240415)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240445, 240510)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240555, 240620)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240730, 240755)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240925, 240950)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 240950, 241020)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 241405, 241445)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 241930, 242300)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 242140, 242245)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 244520, 244630)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 244830, 244940)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 245010, 245045)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 245240, 245350)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 250040, 250130)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 250400, 250530)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 250750, 250915)
\end_layout

\begin_layout Plain Layout

# r <- setRange (DW, 250750, 250830)
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

DW$TLSG[DW$TASCSQ > 0.1] <- NA
\end_layout

\begin_layout Plain Layout

r2 <- r[DW$CONC[r] < 5]
\end_layout

\begin_layout Plain Layout

DW$TLS3 <- DW$TLS3+mean (DW$ATX[r2]-DW$TLS3[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLS <- DW$TLS+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLSG <- DW$TLSG+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

plotWAC (subset(DW[r,],,c(Time, ATX, TLS, TLS3, TLSG)), ylab='Temperature
 [C]', 
\end_layout

\begin_layout Plain Layout

         col=c('blue', 'darkgreen', 'red', 'darkgreen', 'darkorange'), #
 ylim=c(-15,-20),
\end_layout

\begin_layout Plain Layout

        lwd=c(2,2,3,2,2), lty=c(1,2,1,1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

Excl[is.na(DW$CONC)] <- TRUE
\end_layout

\begin_layout Plain Layout

# ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# TLS3[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, TLS3, lwd=4, col='darkorange')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

# plotWAC (subset( DW[r,],, c(Time, WIC)))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

DW$WW <- 400 + DW$WIC * 100
\end_layout

\begin_layout Plain Layout

# plotWAC(subset(DW[r,],, c(Time, CONCD, WW)))
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW[r,],, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-8}
\end_layout

\end_inset

 shows the conventional temperature ATX and the LAMS-derived temperatures
 TLS and TLS3, the first found from the four-beam solution and the second
 from the three-beam solution excluding the forward beam.
 Portions of the TLS3 line where the chisquare as defined above is larger
 than 0.1 are shown as dashed lines.
 In this very dense cloud, with droplet concentrations as measured by the
 CDP exceeding 1000
\begin_inset space ~
\end_inset

cm
\begin_inset Formula $^{-3}$
\end_inset

, the forward beam (not plotted) shows departures of many degrees and this
 appears to bias the four-beam solution toward low values.
 Even the three-beam solution (red line) appears to be affected.
 The measurement appears to recover in the gap between clouds, but this
 appears to be a case where the temperature from the LAMS is affected by
 the presence of the cloud droplets to such an extent that it is not reliable.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-9, include=TRUE, fig.cap='See the caption for the preceding figure.
 Data from ARISTO-2016 flight 6, 24:02:50 -- 24:04:15 UTC.', fig.height=4.5>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

DW <- DWsave
\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 240250, 240415)
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

DW$TLSG[DW$TASCSQ > 0.1] <- NA
\end_layout

\begin_layout Plain Layout

r2 <- r[DW$CONC[r] < 5]
\end_layout

\begin_layout Plain Layout

DW$TLS3 <- DW$TLS3+mean (DW$ATX[r2]-DW$TLS3[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLS <- DW$TLS+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLSG <- DW$TLSG+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

plotWAC (subset(DW[r,],,c(Time, ATX, TLS, TLS3, TLSG)), ylab='Temperature
 [C]', 
\end_layout

\begin_layout Plain Layout

         col=c('blue', 'darkgreen', 'red', 'darkgreen', 'darkorange'), #
 ylim=c(-15,-20),
\end_layout

\begin_layout Plain Layout

        lwd=c(2,2,3,2,2), lty=c(1,2,1,1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

Excl[is.na(DW$CONC)] <- TRUE
\end_layout

\begin_layout Plain Layout

ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

TLS3[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, TLS3, lwd=4, col='darkorange')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

# plotWAC (subset( DW[r,],, c(Time, WIC)))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

DW$WW <- 400 + DW$WIC * 100
\end_layout

\begin_layout Plain Layout

# plotWAC(subset(DW[r,],, c(Time, CONCD, WW)))
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW[r,],, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<LAMST-10, include=TRUE, fig.cap='See the caption for the preceding two
 figures.
 Data from ARISTO-2016 flight 6, 25:00:40 -- 25:01:30 UTC.', fig.height=4.5>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

r <- setRange (DW, 250040, 250130)
\end_layout

\begin_layout Plain Layout

layout(matrix(1:2, ncol = 1), widths = 1,  heights = c(5,6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(2,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

ATX <- DW$ATX
\end_layout

\begin_layout Plain Layout

DW$TLSG[DW$TASCSQ > 0.1] <- NA
\end_layout

\begin_layout Plain Layout

r2 <- r[DW$CONC[r] < 5]
\end_layout

\begin_layout Plain Layout

DW$TLS3 <- DW$TLS3+mean (DW$ATX[r2]-DW$TLS3[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLS <- DW$TLS+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

DW$TLSG <- DW$TLSG+mean (DW$ATX[r2]-DW$TLSG[r2],  na.rm=TRUE)
\end_layout

\begin_layout Plain Layout

plotWAC (subset(DW[r,],,c(Time, ATX, TLS, TLS3, TLSG)), ylab='Temperature
 [C]', 
\end_layout

\begin_layout Plain Layout

         col=c('blue', 'darkgreen', 'red', 'darkgreen', 'darkorange'), #
 ylim=c(-15,-20),
\end_layout

\begin_layout Plain Layout

        lwd=c(2,2,3,2,2), lty=c(1,2,1,1,2), legend.position='topright')
\end_layout

\begin_layout Plain Layout

Excl <- DW$CONC < 5
\end_layout

\begin_layout Plain Layout

Excl[is.na(DW$CONC)] <- TRUE
\end_layout

\begin_layout Plain Layout

ATX[Excl] <- NA
\end_layout

\begin_layout Plain Layout

TLS3[Excl] <- NA
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, ATX, lwd=4, col='cyan')
\end_layout

\begin_layout Plain Layout

# lines (DW$Time+0.5, TLS3, lwd=4, col='darkorange')
\end_layout

\begin_layout Plain Layout

# points (DW$Time, TL, pch=20, col='magenta')
\end_layout

\begin_layout Plain Layout

# plotWAC (subset( DW[r,],, c(Time, WIC)))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1)
\end_layout

\begin_layout Plain Layout

DW$WW <- 400 + DW$WIC * 100
\end_layout

\begin_layout Plain Layout

# plotWAC(subset(DW[r,],, c(Time, CONCD, WW)))
\end_layout

\begin_layout Plain Layout

plotWAC(subset(DW[r,],, c(Time, CONCD)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Case 5: Flight 2016-6, 24:02:50 – 24:04:15
\end_layout

\begin_layout Standard
See Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-9}
\end_layout

\end_inset

.
 In this case the 3-beam solution (red line) appears reasonable except for
 two possible errors toward low temperature in regions of very high cloud
 droplet concentration.
 The 4-beam solution shows pronounced errors in those locations, and the
 high chisquare confirms inconsistency among the line-of-sight airspeeds.
\end_layout

\begin_layout Subsubsection
Case 6: Flight 2016-6, 25:00:40 – 25:01:30
\end_layout

\begin_layout Standard
See Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:LAMST-10}
\end_layout

\end_inset

.
 The LAMS-based temperature shows higher values on the edges of the cloud
 and lower values inside the cloud in comparison to the conventional measurement.
 The slow time response of the sensor measuring ATX, with around 3-s time
 constant, may smooth the measurements from that sensor.
 The agreement between 3-beam and 4-beam results lends some support to the
 LAMS-based measurements, as does the mostly low chisquare for the 4-beam
 measurements, even in cloud.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Conclusions, LAMS-measured temperature
\begin_inset CommandInset label
LatexCommand label
name "subsec:Conclusions,-LAMS-measured-tempe"

\end_inset


\end_layout

\begin_layout Standard
The three cloud regions discussed in the first three case studies are the
 best measurements from ARISTO-2015 for this study, and the last three appear
 to be the best from ARISTO-2016.
 The following assessment is based on those studies:
\end_layout

\begin_layout Enumerate
The temperature deduced from LAMS is mostly valid out-of-cloud.
 Because it is only dependent on the LAMS-deduced airspeed and on the Mach
 number that is in turn based on ambient and dynamic pressure, themselves
 calibrated by the LAMS measurements, and it does not rely on any temperature
 sensor beyond that needed for the initial calibration.
 The LAMS-derived temperature therefore can be a useful check on the performance
 of standard temperature sensors and may be useful in flagging problems
 with those sensors.
 However, the LAMS-based measurement of temperature is noisy, especially
 in turbulence, so averaging over periods of at least 10
\begin_inset space ~
\end_inset

s or more appears necessary.
\end_layout

\begin_layout Enumerate
When in cloud, beam 2 is often strongly biased toward negative temperature
 because the measured airspeed appears to be too low.
 The problem does not appear as strongly in the other three beams, perhaps
 because they are at a 35
\begin_inset Formula $^{\circ}$
\end_inset

 angle to the relative wind.
 Possible causes are water on the forward surface that causes defocusing
 of the beam or strong scattering or multiple scattering that displaces
 the effective sample volume closer to the aircraft into distorted airflow.
 The temperature measurement based on a single forward-pointing beam therefore
 is not useful in cloud.
\end_layout

\begin_layout Enumerate
The RMS for the four-beam solution for airspeed is a valuable indicator
 of quality, and it often flags regions with bad measurements when both
 available processing schemes for the LAMS line-of-sight velocities otherwise
 indicate good measurements.
 This benefit from the 4-beam configuration was not anticipated but appears
 to be a particularly important reason for using that configuration.
\end_layout

\begin_layout Enumerate
The airspeed based on the three off-axis beams is much less affected by
 cloud and appears to provide a valid measurement except in very dense cloud.
 The temperature deduced from that measurement of airspeed tends to be slightly
 higher than the standard measurement in warm cloud, as would be expected
 if there is evaporative cooling as a result of wetting of the temperature
 sensor.
 However, this conclusion is based on only a few case studies and is not
 applicable to all cases, so no strung conclusion can be drawn.
\end_layout

\begin_layout Enumerate
It would be especially useful to operate a 4-beam LAMS with the in-cloud
 radiometer and perhaps an unheated temperature sensor to obtain further
 tests of the LAMS-based temperature measurement.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Section
Transient effects on wind measurements, C-130
\end_layout

\begin_layout Standard
Transient effects on measurements of vertical wind were discussed for the
 GV in 
\begin_inset CommandInset href
LatexCommand href
name "this earlier memo"
target "https://drive.google.com/open?id=0B1kIUH45ca5AVEJrbElxWmQzRnc"

\end_inset

.
 The conclusion of that memo was that effects, while detectable and correctable,
 were at the margin of uncertainty for wind measurements and so had little
 significant effect on wind measurements from the GV.
 A similar study is not possible with ARISTO-2015 fights because there wasn't
 a good pitch maneuver to use for this purpose.
 Two good maneuvers were flown in flight 4, 18:21:00–18:26:00 and 18:58:00–19:01
:00, but in each case the LAMS signals were inadequate to provide a good
 measurement of vertical wind, as needed for this study.
 Other pitch maneuvers were flown, but some were compromised by times when
 the LAMS IRU was not working or, in the last 2015 flight, when LAMS signals
 were too weak.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<revised-netcdf, include=TRUE>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

## this treats 50-Hz LAMS specially, without producing a full 50-Hz file
\end_layout

\begin_layout Plain Layout

#' @title getNetCDF
\end_layout

\begin_layout Plain Layout

#' @description Loads selected variables in a specified netCDF data file
 into a data.frame.
\end_layout

\begin_layout Plain Layout

#' @details 'Time' is converted to a POSIXct variable, and other variables
 specified in 
\end_layout

\begin_layout Plain Layout

#' VarList are included in the data.frame.
 By default, the entire file is loaded, but 
\end_layout

\begin_layout Plain Layout

#' optional arguments Start and End can limit the time range.
 After reading the data, the 
\end_layout

\begin_layout Plain Layout

#' netCDF file is closed before returning the data.frame to the calling program.
\end_layout

\begin_layout Plain Layout

#' The global attributes in the netCDF file are loaded as attributes of
 the returned 
\end_layout

\begin_layout Plain Layout

#' data.frame, and attributes of each requested variable are also assigned
 to that column 
\end_layout

\begin_layout Plain Layout

#' in the data.frame from the variable attributes in the netCDF file.
\end_layout

\begin_layout Plain Layout

#' When working with attributes, it is a feature of R data.frames that subsetting
 loses 
\end_layout

\begin_layout Plain Layout

#' all the assigned variable attributes.
 To preserve them, copy them via 
\end_layout

\begin_layout Plain Layout

#' A <- attributes (Data$VAR), remove A$dim (e.g., A$dim <- NULL),
\end_layout

\begin_layout Plain Layout

#' and re-assign via attributes (DataNew$VAR) <- A.
 The function does not handle 
\end_layout

\begin_layout Plain Layout

#' multi-dimensional variables (e.g., CCDP, the size distribution measured
 by a cloud
\end_layout

\begin_layout Plain Layout

#' droplet probe) yet; it does work for 25-Hz files, and returns with fractional
-second times.
\end_layout

\begin_layout Plain Layout

#' @aliases getnetcdf GetNetCDF
\end_layout

\begin_layout Plain Layout

#' @author William Cooper
\end_layout

\begin_layout Plain Layout

#' @import ncdf4
\end_layout

\begin_layout Plain Layout

#' @importFrom signal filter sgolay
\end_layout

\begin_layout Plain Layout

#' @importFrom stats approx
\end_layout

\begin_layout Plain Layout

#' @export getNetCDF
\end_layout

\begin_layout Plain Layout

#' @param fname string, full-path file name, e.g., "/scr/raf_data/PREDICT/PREDICTr
f01.nc"
\end_layout

\begin_layout Plain Layout

#' @param VarList vector of variable names to load from the netCDF file.
 Use "ALL" to load 
\end_layout

\begin_layout Plain Layout

#' everything.
 (May produce quite large data.frames.) The default is the list given by
\end_layout

\begin_layout Plain Layout

#' standardVariables ().
 
\end_layout

\begin_layout Plain Layout

#' SPECIAL NOTE: Some variable names
\end_layout

\begin_layout Plain Layout

#' have a suffix indicating the location on the aircraft, like _LWI (left-wing
 inboard).
\end_layout

\begin_layout Plain Layout

#' To avoid having to supply these, a partial name can be supplied, like
 "CONCD_", and
\end_layout

\begin_layout Plain Layout

#' the routine will find the first matching variable and use that variable
 name.
 These
\end_layout

\begin_layout Plain Layout

#' can always be overridden by providing the full name; this is just a convenien
ce to
\end_layout

\begin_layout Plain Layout

#' avoid having to look up where a particular measurement was installed
 in a given project.
\end_layout

\begin_layout Plain Layout

#' @param Start An optional numeric giving the desired start time in HHMMSS
 format
\end_layout

\begin_layout Plain Layout

#' @param End An optional numeric giving the desired end time in HHMMSS
 format
\end_layout

\begin_layout Plain Layout

#' @param F An optional numeric entered in the data.frame as a column 'RF'
 all set to 
\end_layout

\begin_layout Plain Layout

#' this integer.
 This may be useful when the resulting data.frame is combined with others,
 
\end_layout

\begin_layout Plain Layout

#' to have a variable distinguishing different flights.
\end_layout

\begin_layout Plain Layout

#' @return data.frame containing the specified variables as columns, along
 with 'Time' 
\end_layout

\begin_layout Plain Layout

#' and optionally the flight number 'RF'.
 The netCDF-file attributes and variable
\end_layout

\begin_layout Plain Layout

#' attributes are assigned to the data.frame and columns, respectively.
\end_layout

\begin_layout Plain Layout

#' @examples 
\end_layout

\begin_layout Plain Layout

#' 
\backslash
dontrun{D <- getNetCDF ("PathToFile.nc", c("Var1", "Var2", "Var3"))}
\end_layout

\begin_layout Plain Layout

#' 
\backslash
dontrun{D <- getNetCDF ("PathToFile.nc", c("Var1", "Var2"), 133000, 143000,
 5)}
\end_layout

\begin_layout Plain Layout

getNetCDF <- function (fname, VarList=standardVariables(), Start=0, End=0,
 F=0) {
\end_layout

\begin_layout Plain Layout

  # This function reads the netCDF file 'fname' and extracts 
\end_layout

\begin_layout Plain Layout

  # the variables specified in 'VarList', returning the
\end_layout

\begin_layout Plain Layout

  # results in a data.frame.
 It includes the flight number F
\end_layout

\begin_layout Plain Layout

  # in the data.frame, as variable RF.
 It converts "Time",
\end_layout

\begin_layout Plain Layout

  # seconds after a reference time in the netCDF files, to
\end_layout

\begin_layout Plain Layout

  # a POSIXct date/time variable.
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  ## get the header information
\end_layout

\begin_layout Plain Layout

  netCDFfile = nc_open (fname)
\end_layout

\begin_layout Plain Layout

  if ("ALL" %in% VarList) {
\end_layout

\begin_layout Plain Layout

    VarList <- names (netCDFfile$var)
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  ## check that requested variables are present in netCDF file; fail otherwise
\end_layout

\begin_layout Plain Layout

  namesCDF <- names (netCDFfile$var)
\end_layout

\begin_layout Plain Layout

  for (V in VarList) {
\end_layout

\begin_layout Plain Layout

    if (is.na(V)) {next}
\end_layout

\begin_layout Plain Layout

    if (length (which (grepl (V, namesCDF)))) {next}
\end_layout

\begin_layout Plain Layout

    cat (sprintf ("requested variable %s not in netCDF file;
\backslash
n ----> getNetCDF returning with error", V))
\end_layout

\begin_layout Plain Layout

    return (-1)
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  Time <- ncvar_get (netCDFfile, "Time")
\end_layout

\begin_layout Plain Layout

  DL <- length (Time)
\end_layout

\begin_layout Plain Layout

  ## set the maximum data rate (but not above 100 Hz):
\end_layout

\begin_layout Plain Layout

  Rate <- 1
\end_layout

\begin_layout Plain Layout

  nms <- names(netCDFfile$dim)
\end_layout

\begin_layout Plain Layout

  if ("sps25" %in% nms) {Rate <- 25}
\end_layout

\begin_layout Plain Layout

  # if ("sps50" %in% nms) {Rate <- 50}  ## limit to max 25 Hz (special for
 BEAMn_LAMS)
\end_layout

\begin_layout Plain Layout

  ## comment next line when LAMS 100-Hz vector present but no others
\end_layout

\begin_layout Plain Layout

  # if ("sps100" %in% nms) {Rate <- 100}
\end_layout

\begin_layout Plain Layout

  # print (sprintf ("output rate for this data.frame is %d", Rate))
\end_layout

\begin_layout Plain Layout

  # Expand Time to be high-rate if necessary
\end_layout

\begin_layout Plain Layout

  if (Rate > 1) {
\end_layout

\begin_layout Plain Layout

    T <- vector ("numeric", Rate*length(Time))
\end_layout

\begin_layout Plain Layout

    for (i in 1:length(Time)) {
\end_layout

\begin_layout Plain Layout

      for (j in 0:(Rate-1)) {
\end_layout

\begin_layout Plain Layout

        T[(i-1)*Rate+j+1] <- Time[i] + j/Rate
\end_layout

\begin_layout Plain Layout

      }  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    Time <- T
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  time_units <- ncatt_get (netCDFfile, "Time", "units")
\end_layout

\begin_layout Plain Layout

  tref <- sub ('seconds since ', '', time_units$value)
\end_layout

\begin_layout Plain Layout

  Time <- as.POSIXct (as.POSIXct (tref, tz='UTC')+Time, tz='UTC')
\end_layout

\begin_layout Plain Layout

  # see if limited time range wanted:
\end_layout

\begin_layout Plain Layout

  i1 <- ifelse ((Start != 0), getIndex (Time, Start), 1)
\end_layout

\begin_layout Plain Layout

  i2 <- ifelse ((End != 0), getIndex (Time, End) + Rate - 1, length (Time))
\end_layout

\begin_layout Plain Layout

  # if (End != 0) {
\end_layout

\begin_layout Plain Layout

  #   i2 <- getIndex (Time, End) + Rate - 1
\end_layout

\begin_layout Plain Layout

  # } else {
\end_layout

\begin_layout Plain Layout

  #   i2 <- length (Time)
\end_layout

\begin_layout Plain Layout

  # }
\end_layout

\begin_layout Plain Layout

  r <- i1:i2
\end_layout

\begin_layout Plain Layout

  # r is the appropriate index for any rate, but also need
\end_layout

\begin_layout Plain Layout

  # the 1-Hz and 5-Hz indices for interpolation:
\end_layout

\begin_layout Plain Layout

  r1 <- ((i1-1)/Rate+1):((i2-1)/Rate+1)
\end_layout

\begin_layout Plain Layout

  DL <- length (r1)
\end_layout

\begin_layout Plain Layout

  Time <- Time[r]
\end_layout

\begin_layout Plain Layout

  SE <- getStartEnd (Time)
\end_layout

\begin_layout Plain Layout

  ## save 'Time' attributes:
\end_layout

\begin_layout Plain Layout

  ATT <- ncatt_get (netCDFfile, "Time")   # get list of Time attributes
\end_layout

\begin_layout Plain Layout

  for (A in names (ATT)) {
\end_layout

\begin_layout Plain Layout

    attr(Time, A) <- ATT[[A]]
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  d <- data.frame(Time)
\end_layout

\begin_layout Plain Layout

  ## save the dimensions, useful for archiving or re-writing to netCDF:---------
----
\end_layout

\begin_layout Plain Layout

  ##    but, to save space, omit the list of times
\end_layout

\begin_layout Plain Layout

  nf <- netCDFfile
\end_layout

\begin_layout Plain Layout

  nf$dim[1]$Time$vals <- NULL
\end_layout

\begin_layout Plain Layout

  attr (d, "Dimensions") <- nf$dim
\end_layout

\begin_layout Plain Layout

  ## Save all the global attributes in the netCDF file as 'd' attributes:-------
---
\end_layout

\begin_layout Plain Layout

  ATT <- ncatt_get (netCDFfile, 0)   # get list of global attributes
\end_layout

\begin_layout Plain Layout

  for (A in names (ATT)) {
\end_layout

\begin_layout Plain Layout

    attr(d, A) <- ATT[[A]]
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  attr (d, "R_dataframe_created") <- date()    # add one global attribute
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  ######------------------------------------------------------------------
\end_layout

\begin_layout Plain Layout

  IntFilter <- function (X, inRate, outRate) {
\end_layout

\begin_layout Plain Layout

    if (inRate == outRate) {return (X)}
\end_layout

\begin_layout Plain Layout

    ratio <- as.integer(outRate/inRate)    ## expected to be an integer
\end_layout

\begin_layout Plain Layout

    ## beware of missing values
\end_layout

\begin_layout Plain Layout

    z <- zoo::na.approx (as.vector(X), maxgap=1000, na.rm = FALSE)
\end_layout

\begin_layout Plain Layout

    z[is.na(z)] <- 0
\end_layout

\begin_layout Plain Layout

    x <- 0:(length(X)-1)
\end_layout

\begin_layout Plain Layout

    A <- stats::approx (x, z, n=length(X)*ratio-ratio+1)
\end_layout

\begin_layout Plain Layout

    T <- A$y
\end_layout

\begin_layout Plain Layout

    T <- signal::filter(signal::sgolay(4,75),T)
\end_layout

\begin_layout Plain Layout

    ## now shift to match 25-Hz:
\end_layout

\begin_layout Plain Layout

    n <- as.integer (ratio / 2)
\end_layout

\begin_layout Plain Layout

    NL = length(T)
\end_layout

\begin_layout Plain Layout

    T <- c(rep(T[1],n), T, rep(T[NL],ratio-n-1))  ## OK, even or odd ratio
\end_layout

\begin_layout Plain Layout

    return (T)
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  ######------------------------------------------------------------------
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  ## Add the requested variables:-----------------------------------------------
-
\end_layout

\begin_layout Plain Layout

  for (V in VarList) {
\end_layout

\begin_layout Plain Layout

    if (is.na(V)) {next}
\end_layout

\begin_layout Plain Layout

    ## fill in location-tag for variable name if needed:
\end_layout

\begin_layout Plain Layout

    if (substr(V, nchar(V), nchar(V)) == '_') {
\end_layout

\begin_layout Plain Layout

      for (ncn in namesCDF) {
\end_layout

\begin_layout Plain Layout

        if (grepl (V, ncn)) {V <- ncn; break}   ## note, takes 1st match
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    ## save dimensions for the variable:
\end_layout

\begin_layout Plain Layout

    datt <- list()
\end_layout

\begin_layout Plain Layout

    for (dd in netCDFfile$var[[V]]$dim) {
\end_layout

\begin_layout Plain Layout

      datt[[length(datt)+1]] <- dd$name
\end_layout

\begin_layout Plain Layout

    }    ## later, save datt as an attribute of V
\end_layout

\begin_layout Plain Layout

    X <- ncvar_get (netCDFfile, V)
\end_layout

\begin_layout Plain Layout

    ATT <- ncatt_get (netCDFfile, V)
\end_layout

\begin_layout Plain Layout

    ## for Rate == 1, nothing special is needed:
\end_layout

\begin_layout Plain Layout

    if (Rate == 1) {
\end_layout

\begin_layout Plain Layout

      X <- X[r1]
\end_layout

\begin_layout Plain Layout

    } else { ## other rates require flattening and possibly interpolation
 and filtering
\end_layout

\begin_layout Plain Layout

      DM <- length(dim(X))           
\end_layout

\begin_layout Plain Layout

      if (DM == 2) {    # flatten
\end_layout

\begin_layout Plain Layout

        X <- X[,r1]
\end_layout

\begin_layout Plain Layout

        inputRate <- dim(X)[1]
\end_layout

\begin_layout Plain Layout

        needFilter <- ifelse ((dim(X)[1] != Rate), TRUE, FALSE)
\end_layout

\begin_layout Plain Layout

        dim(X) <- dim(X)[1]*dim(X)[2]
\end_layout

\begin_layout Plain Layout

        ## see if adjustment to max rate is needed
\end_layout

\begin_layout Plain Layout

        if (needFilter) {X <- IntFilter(X, inputRate, Rate)}
\end_layout

\begin_layout Plain Layout

      } else {  ## single-dimension (1 Hz) in high-rate file
\end_layout

\begin_layout Plain Layout

        X <- X[r1]
\end_layout

\begin_layout Plain Layout

        X <- IntFilter (X, 1, Rate)
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    } 
\end_layout

\begin_layout Plain Layout

    ## add variable attributes as in netCDF file
\end_layout

\begin_layout Plain Layout

    for (A in names (ATT)) {
\end_layout

\begin_layout Plain Layout

      attr (X, A) <- ATT[[A]]
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    attr (X, "Dimensions") <- datt
\end_layout

\begin_layout Plain Layout

    d[V] <- X
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  if (F != 0) {    # if specified, include the flight number
\end_layout

\begin_layout Plain Layout

    RF <- rep (F, times=length(Time))    # label flight number
\end_layout

\begin_layout Plain Layout

    d["RF"] <- RF
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  nc_close (netCDFfile)
\end_layout

\begin_layout Plain Layout

  return (d)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<Transient-1, include=TRUE, fig.height=4.5, fig.cap=c('A flight segment with
 pitch variations from flight 6 or ARISTO-2016.
 The blue line shows the difference between the LAMS-based vertical wind
 (WIL) and the conventional measurement (WIC).
 Also shown are the rate-of-climb divided by 10 (GGVSPD/10, dashed green
 line), the angle of attack (AKRD, dotted red line), and the normal component
 of aircraft acceleration (BNORMA, magenta line).', 'As in the preceding
 figure but for the vertical wind error after correction for the assumed
 dependence on normal acceleration, as described in the text.')>>=
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Directory <- DataDirectory ()
\end_layout

\begin_layout Plain Layout

Flight <- "rf06hr" 		
\end_layout

\begin_layout Plain Layout

Project = "AR16"		
\end_layout

\begin_layout Plain Layout

ProjectDir <- 'ARISTO'
\end_layout

\begin_layout Plain Layout

fname = sprintf("%s%s/%s%sLAMS.nc", Directory,ProjectDir,Project,Flight)
\end_layout

\begin_layout Plain Layout

SaveRData2 <- sprintf("%s2.Rdata", thisFileName)
\end_layout

\begin_layout Plain Layout

VarList2 <- VarList2[-32]    ## there is a problem with CONCD_RWT in this
 file
\end_layout

\begin_layout Plain Layout

if (ReloadData) {
\end_layout

\begin_layout Plain Layout

  Data2 <- getNetCDF (fname, c(VarList2, 'BNORMA'))
\end_layout

\begin_layout Plain Layout

  Data2$QR <- Data2$ADIFR / Data2$QCF
\end_layout

\begin_layout Plain Layout

  Data2$Mach <- MachNumber (Data2$PSFD, Data2$QCF, Data2$EWX)
\end_layout

\begin_layout Plain Layout

  Data2$AKRD <- cfl[1] + Data2$QR * (cfl[2] + cfl[3] * Data2$Mach) 		
\end_layout

\begin_layout Plain Layout

  Data2$SSLIP <- Data2$SSRD
\end_layout

\begin_layout Plain Layout

  Data2$ATTACK <- Data2$AKRD
\end_layout

\begin_layout Plain Layout

  save(Data2, file=SaveRData2)
\end_layout

\begin_layout Plain Layout

} else {
\end_layout

\begin_layout Plain Layout

  load(SaveRData2)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

SampleRate <- 25  
\end_layout

\begin_layout Plain Layout

DW <- processWind (Data2)
\end_layout

\begin_layout Plain Layout

DW$BNORMA <- Data2$BNORMA
\end_layout

\begin_layout Plain Layout

DW$WIL <- ShiftInTime (DW$WIN, 25, 100)  ## shift LAMS wind backward
\end_layout

\begin_layout Plain Layout

## recalculate the vertical wind, for reference and to include the GPS-to-IRU
 distance:
\end_layout

\begin_layout Plain Layout

DS <- WindProcessor (Data2)
\end_layout

\begin_layout Plain Layout

DW$WIN <- DS$WIN
\end_layout

\begin_layout Plain Layout

DW$WIC <- Data2$WIC
\end_layout

\begin_layout Plain Layout

layout(matrix(1:1, ncol = 1), widths = 1,  heights = c(6))
\end_layout

\begin_layout Plain Layout

op <- par (mar=c(5,4,1,1)+0.1, oma=c(1.1,0,0,0))
\end_layout

\begin_layout Plain Layout

r <- setRange(DW, 205720, 205815)
\end_layout

\begin_layout Plain Layout

# summary(lm((WIL-WIN)~AKRD, data=DW[r,]))$sigma
\end_layout

\begin_layout Plain Layout

with(DW[r,], plotWAC(data.frame(Time, WIL-WIN, GGVSPD/10, AKRD, BNORMA),
 ylab='WIL-WIC', col=c('blue', 'darkgreen', 'red', 'magenta'), lty=c(1,2,3,1)))
\end_layout

\begin_layout Plain Layout

fw <- lm((WIL-WIN)~BNORMA, data=DW[r,])
\end_layout

\begin_layout Plain Layout

cfw <- coef (fw)
\end_layout

\begin_layout Plain Layout

DW$WIX <- DW$WIN + cfw[1] + cfw[2]*DW$BNORMA
\end_layout

\begin_layout Plain Layout

with(DW[r,], plotWAC(data.frame(Time, WIL-WIX, GGVSPD/10, AKRD, BNORMA),
 ylab='WIL-WIX', col=c('blue', 'darkgreen', 'red', 'magenta'), lty=c(1,2,3,1)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
There were two good maneuvers with rapid pitch changes on flight 6 of ARISTO-201
6, at 20:57:00–20:59:00 and 21:15:00–21:17:00 UTC.
 The same approach was taken to these maneuvers as for the earlier study
 of the GV:
\end_layout

\begin_layout Enumerate
Produce a high-rate (25 Hz) netCDF file for the period of the two maneuvers.
 This was saved as /scr/raf/cooperw/AR16rf06hr.nc on the EOL file system.
 Note that there is an apparent bug in nimbus that prevents production of
 the beam-speed histograms (BEAM1_LAMS, etc) at 25 Hz, giving all-zero values,
 so these variables were produced at 50 Hz instead and the next processing
 step was modified to average those to 25 Hz before proceeding.
 The 
\end_layout

\begin_layout Enumerate
Process this file using the Python program LAMS_ARISTO.py.
 This was modified from the one used for other data files to include the
 averaging of the 50-Hz beam-speed histograms to 25 Hz before proceeding.
 That program produced a new netCDF file named AR16rf06hrLAMS.nc with added
 variables BEAM[1-4]speed, needed for the present R program.
\end_layout

\begin_layout Enumerate
This program (ARISTO-LAMS.Rnw) then read a subset of variables from that
 file and calculated WIL, the LAMS-based vertical wind.
 The conventional wind (WIC) was also recalculated using the sensitivity
 coefficients recommended in this report.
 To compensate for the displacement between the LAMS-based vertical wind
 and that based on the radome, the LAMS-based value was delayed by 100
\begin_inset space ~
\end_inset

ms after some study of how the difference between WIL and WIC varied with
 this choice.
\end_layout

\begin_layout Standard
The resulting difference between WIL and WIC then was used to investigate
 if there appeared to be a false signal in the vertical wind and, if so,
 to search for its source.
 Figure
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:Transient-11}
\end_layout

\end_inset

 shows that this difference shows clear dependence on angle-of-attack, rate-of-c
limb, and normal acceleration of the aircraft.
 The dependence on angle of attack is surprising because this flight was
 used to determine the sensitivity coefficients in use, so residual dependence
 on angle-of-attack indicates that this region has a different dependence
 in comparison to the entire flight.
 The variable showing the strongest correlation to the error, however, is
 BNORMA, as was also found in the study of the GV.
 In the interval plotted, the correlation between (WIL-WIC) and BNORMA is
 0.82.
 As in the case of the GV, the correlation with rate-of-change of pitch
 was almost identical to that with BNORMA, and the correlation to angle-of-attac
k was 0.77, but other variables (GGVSPD, rate of change of angle of attack,
 PITCH) gave significantly lower correlation to the error.
\end_layout

\begin_layout Standard
As for the GV, a suggested correction for this effect is to add 
\begin_inset Formula $g_{0}+g_{1}(\mathrm{BNORM})$
\end_inset

 to WIC, where {
\begin_inset Formula $g_{0},\,g_{1}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfw[1], 3)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfw[2], 3)}
\end_layout

\end_inset

}.
\begin_inset Foot
status open

\begin_layout Plain Layout
Perhaps better would be to make the equivalent correction to AKRD before
 calculation of the vertical wind.
\end_layout

\end_inset

 When this correction is made, the new variable (WIX), shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

{fig:Transient-12}
\end_layout

\end_inset

, no longer appears to depend on any of the other plotted variables.
 With this correction, the standard deviation in the difference between
 the LAMS-based and corrected vertical wind was 0.34
\begin_inset space ~
\end_inset

m/s, similar to the standard deviation for a similar 30-s period just before
 the maneuver (0.49
\begin_inset space ~
\end_inset

m/s).
 The applied correction had a standard deviation of 0.37
\begin_inset space ~
\end_inset

m/s, so about half of the observed variance between WIL and WIC is removed
 by this correction.
 
\end_layout

\begin_layout Standard
The second pitch maneuver (21:15:00 – 21:17:00 UTC) was a little more turbulent,
 but the results were consistent with those from the first.
\end_layout

\begin_layout Subsection*
Summary - Transient Effects
\end_layout

\begin_layout Enumerate
The pitch maneuver revealed that the difference between the LAMS-derived
 vertical wind and that from the radome-based system varied with the vertical
 acceleration.
 The estimated magnitude of the combined effects, however, is modest, leading
 to typical errors in WIC of about 0.4
\begin_inset space ~
\end_inset

m/s when the vertical acceleration was in the range 
\begin_inset Formula $\pm2\thinspace$
\end_inset

m
\begin_inset space \thinspace{}
\end_inset

s
\begin_inset Formula $^{-2}$
\end_inset

, as is typical of all but the most extreme flight conditions.
\end_layout

\begin_layout Enumerate
A correction can be used to remove this error in vertical wind.
 After application of that regression correction based on the pitch maneuver,
 the measurements of vertical wind from the radome-based system agree with
 those from the LAMS with a standard deviation between the two measurements
 of about 0.4
\begin_inset space ~
\end_inset

m/s during that pronounced maneuver.
 This was significantly larger than that obtained for the GV, but this maneuver
 was flown in more turbulent conditions where the true fluctuations in wind
 were about of this magnitude.
\end_layout

\begin_layout Section
Summary and Conclusions
\end_layout

\begin_layout Enumerate
The four-beam LAMS produced useful measurements in all four beams for major
 parts of the ARISTO flights.
\end_layout

\begin_deeper
\begin_layout Enumerate
The overconstrained solution for airspeed using all four beams provided
 a useful measure of consistency that can be used to avoid instances where
 the algorithm providing the line-of-sight airspeeds produced erroneous
 results.
 A proposed limit on the chisquare from the fit appeared to be useful, as
 described in Section 2.
\end_layout

\begin_layout Enumerate
The airspeed from the forward beam usually measured an airspeed that was
 within about 0.3
\begin_inset space ~
\end_inset

m/s of the airspeed determined from the other three off-axis beams.
\end_layout

\begin_layout Enumerate
Dense cloud appeared to affect the measurements, especially for the forward
 beam.
 The three off-axis beams were less affected, but very dense cloud produced
 erroneous measurements in all four beams.
\end_layout

\begin_layout Enumerate
The downward-slanted beam occasionally was contaminated by return from the
 surface during low-level flight.
\end_layout

\begin_layout Enumerate
One flight (flight 6 of ARISTO-2016) included a wide range of conditions
 spanning the altitude range of the C-130 and gave a good basis for determining
 the fitted coefficients for the radome sensitivity and the static defect
 based on the the range of conditions normally encountered by the C-130,
 including for flight near sea level.
\end_layout

\end_deeper
\begin_layout Enumerate
New sensitivity coefficients were determined for the radome:
\end_layout

\begin_deeper
\begin_layout Enumerate
For angle of attack, new suggested sensitivity coefficients based on calibration
 to match LAMS-based measurements are {
\begin_inset Formula $c_{0},\,c_{1},\,c_{2}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[2], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfl[3], 4)}
\end_layout

\end_inset

}.
 Cf.
\begin_inset space ~
\end_inset

Equation
\begin_inset space ~
\end_inset

(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:akrd-fit"

\end_inset

).
 These coefficients have been adjusted to account for the offset in vertical
 alignment between the LAMS IRU and the upward axis normal to the longitudinal
 axis of the aircraft.
\end_layout

\begin_layout Enumerate
For sideslip, the suggested coefficients are {
\begin_inset Formula $b_{0},\,b_{1}$
\end_inset

} = {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfs[1], 4)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cfls[2], 4)}
\end_layout

\end_inset

}.
 (Cf.
\begin_inset space ~
\end_inset

Eq.
\begin_inset space ~
\end_inset

(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ssrd"

\end_inset

).
 The second coefficient is based on the LAMS-based calibration, while the
 first was determined from a conventional calibration using yaw maneuvers;
 the justification is that the relative offset in installation orientation
 between the LAMS and the longitudinal axis of the aircraft is uncertain
 so this coefficient is chosen to match the conventional-calibration value.
 (The value determined from the LAMS calibration is only about 0.05
\begin_inset Formula $^{\circ}$
\end_inset

 larger than the coefficient listed.) The first coefficient (i.e., the offset
 in sideslip) still needs to be determined from good circle maneuvers, which
 can separate an offset in heading from one in sideslip.
 It is significant, though, that these calibrations suggest a change in
 offset of about 1.6
\begin_inset Formula $^{\circ}$
\end_inset

 from the standard coefficients.
 This will have a significant effect on calculated horizontal wind.
\end_layout

\begin_layout Enumerate
Because the LAMS provides reference values for calibrations such as these
 that are superior to those obtained in the conventional way (dependent
 on zero vertical wind), it will be useful to include LAMS-based calibration
 in future projects where the measurement of vertical wind is needed with
 low uncertainty.
\end_layout

\end_deeper
\begin_layout Enumerate
A new parameterized correction to static and dynamic pressure was determined
 using a wide range of flight conditions spanning the altitude range of
 the C-130.
 The suggested formula is (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:dq-fit"

\end_inset

) with coefficients {
\begin_inset Formula $b_{0-4}$
\end_inset

}={
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[1],6)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[2],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[3],8)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[4],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf[5],6)}
\end_layout

\end_inset

} for the sensing pair producing PSFD and QCF and {
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[1],6)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[2],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[3],8)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[4],5)}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(cf2[5],6)}
\end_layout

\end_inset

} for the sensor pair producing PSFRD and QCFR.
 This correction provides a consistent offset from the avionics-provided
 pressure (PS_A) for recent C-130 projects since IDEAS-4-C130 in 2011, where
 a different correction is needed.
\end_layout

\begin_layout Enumerate
The LAMS-based measurement of temperature provides measurements out-of-cloud
 in good agreement with the conventional temperature sensors.
 In cloud, the measurements are sometimes compromised, especially in very
 dense cloud, but sometimes suggest possibly real differences from the conventio
nal sensors.
 This portion of the study was mostly inconclusive.
 See Sect.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Conclusions,-LAMS-measured-tempe"

\end_inset

 for a more extensive summary.
\end_layout

\begin_layout Enumerate
As was found for the GV, there are indications of transient effects on the
 measured angle-of-attack of the C-130 when the pitch changes rapidly.
 The best correction appeared to be to apply an empirical correction based
 on the measured upward acceleration of the aircraft, as was also the case
 for the GV.
 The correction based on a linear fit to the measured normal acceleration
 BNORMA made corrections of typically about 0.4
\begin_inset space ~
\end_inset

m/s to the vertical wind, a value considerably larger than the typical correctio
n of about 0.1
\begin_inset space ~
\end_inset

m/s that applied to the GV.
 However, except for this increased magnitude of the correction, the features
 of the transient effects appeared similar for the two aircraft.
\end_layout

\begin_layout Standard
\align center

\family sans
\color blue
– End of Memo –
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Reproducibility:
\begin_inset Note Note
status open

\begin_layout Plain Layout
include enough info to re-run.
 in zip, include program, pdf if not too big, and subset data, not entire
 file.
 
\end_layout

\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="2">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="0pt">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Project:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{thisFileName}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Archive package:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{thisFileName}.zip
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Contains:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
attachment list below
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Program:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{thisFileName}.Rnw
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Python:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/h/eol/cooperw/RStudio/LAMS3D/LAMS_ARISTO.py
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Original Data:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/scr/raf_data/ARISTO{2015,2016}/rfxx.nc
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/scr/raf/cooperw/AR16rf06hr.nc
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Workflow:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Workflow
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{thisFileName}.pdf
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family sans
\shape smallcaps
\color blue
Git:
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

https://github.com/WilliamCooper/
\backslash
Sexpr{thisFileName}.git
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
attachm{
\backslash
Sexpr{thisFileName}.Rnw
\backslash

\backslash
LAMS
\backslash
_ARISTO.py
\backslash

\backslash

\backslash
Sexpr{thisFileName}.pdf
\backslash

\backslash
SessionInfo
\backslash

\backslash
WorkflowARISTO-LAMS.pdf
\backslash

\backslash
SaveRData.zip}
\end_layout

\begin_layout Plain Layout

%
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\begin_layout Plain Layout

%
\backslash
attach{attachment}
\end_layout

\begin_layout Plain Layout

%
\backslash
attachm{first
\backslash

\backslash
second} %
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\begin_layout Plain Layout

<<save-system-info, echo=FALSE>>= 
\end_layout

\begin_layout Plain Layout

cat (toLatex(sessionInfo()), file="SessionInfo")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@ 
\end_layout

\begin_layout Plain Layout

<<make-zip-archive, echo=TRUE, INCLUDE=TRUE>>=
\end_layout

\begin_layout Plain Layout

system (sprintf ('zip SaveRData.zip %s*Rdata', thisFileName))
\end_layout

\begin_layout Plain Layout

system (sprintf("zip %s.zip %s.Rnw %s.pdf LAMS_ARISTO.py Workflow%s.pdf SessionInfo
 SaveRData.zip", thisFileName, thisFileName, thisFileName, thisFileName))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@ 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

% 
\backslash
attach{attachment}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% 
\backslash
attachm{ProgramFile
\backslash

\backslash
Document.pdf
\backslash

\backslash
SaveRData}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

%
\backslash
cc{first attachment
\backslash

\backslash
second
\backslash

\backslash
3rd att}
\end_layout

\end_inset


\end_layout

\end_body
\end_document
